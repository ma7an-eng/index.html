<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±ÙˆØªÙŠÙ† Ø§Ù„Ø¹Ø¸Ù…Ø§Ø¡ - V8 Sketch & Stats</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --bg-main: #f4f4f9;
            --bg-card: #ffffff;
            --text-primary: #222222;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --accent-black: #000000;
            --success-green: #27ae60; /* Ù„ÙˆÙ† Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ÙˆØ­ÙŠØ¯ */
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Cairo', sans-serif; }

        body {
            background-color: var(--bg-main); color: var(--text-primary);
            min-height: 100vh; display: flex; justify-content: center; padding-bottom: 80px;
        }

        .app-container {
            width: 100%; max-width: 600px; background: var(--bg-card); min-height: 100vh;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05); position: relative;
        }

        /* --- Ù‚Ø³Ù… Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© (Ø§Ù„Ø³ÙƒØªØ´ ÙˆØ§Ù„Ø§Ù‚ØªØ¨Ø§Ø³) --- */
        .sketch-header {
            position: relative;
            height: 280px;
            background: #000;
            overflow: hidden;
            border-bottom: 3px solid var(--accent-black);
        }

        .sketch-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* Ø§Ù„Ø³Ø­Ø± Ù‡Ù†Ø§: ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ù„Ø³ØªØ§ÙŠÙ„ Ø±Ø³Ù… Ø¨Ù‚Ù„Ù… Ø§Ù„Ø±ØµØ§Øµ */
            filter: grayscale(100%) contrast(200%) brightness(1.2) sharp(10px);
            opacity: 0.8;
        }

        .quote-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            padding: 20px; color: #fff;
        }
        .quote-text { font-size: 1.1rem; font-weight: 700; line-height: 1.5; text-shadow: 1px 1px 3px #000; }
        .quote-author { font-size: 0.9rem; color: #ccc; margin-top: 5px; }
        
        .date-bar {
            background: #fff; padding: 10px 20px; text-align: center; border-bottom: 1px solid var(--border-color); font-weight: bold;
        }

        /* --- Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ÙˆØ§Ù„Ø¹Ø±Ø¶ --- */
        .view-section { display: none; padding: 20px; animation: fadeUp 0.3s ease; }
        .view-section.active { display: block; }
        @keyframes fadeUp { from {opacity:0; transform: translateY(10px);} to {opacity:1; transform: translateY(0);} }

        /* ÙƒØ§Ø±Øª Ø§Ù„Ù…Ù‡Ù…Ø© (Ø§Ù„ÙŠÙˆÙ…) */
        .task-card {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; border: 1px solid var(--border-color); border-radius: 12px;
            margin-bottom: 10px; background: #fff; transition: 0.2s;
        }
        .task-info h3 { font-size: 1rem; font-weight: 700; }
        .task-time { font-size: 0.85rem; color: var(--text-secondary); display: flex; align-items: center; gap: 5px; }

        .check-btn {
            width: 35px; height: 35px; border-radius: 50%; border: 2px solid #ccc;
            background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;
            color: transparent; font-size: 1.2rem; transition: 0.2s;
        }
        .check-btn:hover { border-color: var(--accent-black); }

        .task-card.done { background: #f9f9f9; border-color: #eee; }
        .task-card.done h3 { text-decoration: line-through; color: #aaa; }
        .task-card.done .check-btn { background: var(--success-green); border-color: var(--success-green); color: white; }

        /* --- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª (Ø¬Ø¯ÙŠØ¯) --- */
        .stats-container {
            background: #fff; padding: 25px; border-radius: 15px; border: 1px solid var(--border-color);
            text-align: center;
        }
        .chart-wrapper { position: relative; height: 250px; width: 250px; margin: 0 auto 20px; }
        .stats-summary { display: flex; justify-content: space-around; margin-top: 20px; }
        .stat-box h4 { font-size: 2rem; font-weight: 900; }
        .stat-box span { font-size: 0.9rem; color: var(--text-secondary); }

        /* --- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ®Ø·ÙŠØ· --- */
        .day-scroller { display: flex; overflow-x: auto; gap: 8px; padding-bottom: 10px; margin-bottom: 20px; scrollbar-width: none; }
        .day-scroller::-webkit-scrollbar { display: none; }
        .day-chip { padding: 8px 18px; background: #eee; border-radius: 30px; font-size: 0.9rem; white-space: nowrap; cursor: pointer; font-weight: 600; }
        .day-chip.active { background: var(--accent-black); color: #fff; }
        .input-box { display: flex; gap: 10px; margin-bottom: 20px; }
        .input-box input { flex: 1; padding: 12px; border: 2px solid #eee; border-radius: 8px; outline: none; }
        .input-box input:focus { border-color: var(--accent-black); }
        .btn-add { background: var(--accent-black); color: #fff; border: none; padding: 0 25px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .routine-item { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #eee; align-items: center; }
        .btn-del { color: var(--text-secondary); cursor: pointer; font-size: 0.85rem; text-decoration: underline; }

        /* --- Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ --- */
        .nav-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; border-top: 1px solid #eee;
            display: flex; justify-content: space-around; padding: 10px; z-index: 100;
        }
        .nav-link { background: none; border: none; font-weight: 700; color: #aaa; cursor: pointer; font-size: 0.9rem; display: flex; flex-direction: column; align-items: center; }
        .nav-link.active { color: var(--accent-black); }
        .nav-icon { font-size: 1.2rem; margin-bottom: 2px; }

    </style>
</head>
<body>

    <div class="app-container">
        
        <div class="sketch-header">
            <img id="dailySketchBtn" src="" class="sketch-img">
            <div class="quote-overlay">
                <p class="quote-text" id="dailyQuote">...</p>
                <p class="quote-author" id="dailyAuthor">...</p>
            </div>
        </div>
        <div class="date-bar" id="headerDate">--/--/----</div>

        <div id="viewToday" class="view-section active">
            <h2 style="margin-bottom: 15px;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙŠÙˆÙ…</h2>
            <div id="tasksContainer"></div>
            <div id="emptyState" style="text-align: center; margin-top: 40px; color: #999;">
                Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ….<br>Ø£Ø¶Ù Ø±ÙˆØªÙŠÙ†Ùƒ Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„.
            </div>
        </div>

        <div id="viewPlan" class="view-section">
            <h3 style="margin-bottom: 15px;">ØªØ®Ø·ÙŠØ· Ø§Ù„Ø±ÙˆØªÙŠÙ†</h3>
            <div class="day-scroller" id="dayScroller"></div>
            
            <div class="input-box">
                <input type="text" id="taskName" placeholder="Ø§Ù„Ù…Ù‡Ù…Ø©..." style="flex:2">
                <input type="time" id="taskTime" style="flex:1">
                <button class="btn-add" onclick="addTask()">+</button>
            </div>

            <div>
                <h4 style="font-size:0.9rem; color:#777; margin-bottom:10px">Ø±ÙˆØªÙŠÙ† ÙŠÙˆÙ… <span id="selectedDayLabel">--</span>:</h4>
                <div id="routineContainer"></div>
            </div>
        </div>

        <div id="viewStats" class="view-section">
            <h3 style="margin-bottom: 20px;">Ø£Ø¯Ø§Ø¤Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</h3>
            
            <div class="stats-container">
                <div class="chart-wrapper">
                    <canvas id="monthlyChart"></canvas>
                </div>
                
                <div class="stats-summary">
                    <div class="stat-box">
                        <h4 id="totalDoneMonth" style="color: var(--success-green)">0</h4>
                        <span>Ù…ÙƒØªÙ…Ù„Ø©</span>
                    </div>
                    <div class="stat-box">
                        <h4 id="totalMissedMonth" style="color: #999">0</h4>
                        <span>ÙØ§Ø¦ØªØ©/Ù…ØªØ¨Ù‚ÙŠØ©</span>
                    </div>
                </div>
                <p style="margin-top: 15px; font-size: 0.9rem; color: #666;">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø´Ù‡Ø± <span id="currentMonthName"></span></p>
            </div>
        </div>

    </div>

    <div class="nav-bar">
        <button class="nav-link active" onclick="switchView('today')" id="btnToday">
            <span class="nav-icon">ğŸ“</span> Ø§Ù„ÙŠÙˆÙ…
        </button>
        <button class="nav-link" onclick="switchView('plan')" id="btnPlan">
            <span class="nav-icon">ğŸ“…</span> Ø§Ù„Ø¬Ø¯ÙˆÙ„
        </button>
        <button class="nav-link" onclick="switchView('stats')" id="btnStats">
            <span class="nav-icon">ğŸ“Š</span> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        </button>
    </div>

    <script>
        // --- 1. Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø¶Ø®Ù…Ø© Ù„Ù„ØµÙˆØ± ÙˆØ§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª (ØºÙŠØ± Ù…ØªÙƒØ±Ø±Ø©) ---
        const inspirationData = [
            // Ø¥ÙŠÙ„ÙˆÙ† Ù…Ø§Ø³Ùƒ - Ø§Ù„ÙØ¶Ø§Ø¡ ÙˆØ§Ù„ØµÙˆØ§Ø±ÙŠØ®
            { img: "https://upload.wikimedia.org/wikipedia/commons/9/92/SpaceX_Starship_SN8_launch_pad.jpg", quote: "Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ø´ÙŠØ¡ Ù…Ø§ Ù…Ù‡Ù…Ø§Ù‹ Ø¨Ù…Ø§ ÙÙŠÙ‡ Ø§Ù„ÙƒÙØ§ÙŠØ©ØŒ ÙØ¥Ù†Ùƒ ØªÙØ¹Ù„Ù‡ Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù†Øª Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª Ø¶Ø¯Ùƒ.", author: "Ø¥ÙŠÙ„ÙˆÙ† Ù…Ø§Ø³Ùƒ" },
            { img: "https://upload.wikimedia.org/wikipedia/commons/d/de/Falcon_Heavy_Demo_Mission_%2839337245145%29.jpg", quote: "Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù‡ÙŠ Ø¥Ø«Ø¨Ø§Øª Ø£Ù† Ø§Ù„Ø´ÙŠØ¡ Ù…Ù…ÙƒÙ†Ø› Ø«Ù… Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„ Ø³ÙŠØ­Ø¯Ø«.", author: "Ø¥ÙŠÙ„ÙˆÙ† Ù…Ø§Ø³Ùƒ" },
            { img: "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c0/SpaceX_Starlink_Mission_%2847926144523%29.jpg/1280px-SpaceX_Starlink_Mission_%2847926144523%29.jpg", quote: "Ø§Ù„Ù…Ø«Ø§Ø¨Ø±Ø© Ù…Ù‡Ù…Ø© Ø¬Ø¯Ø§Ù‹. Ù„Ø§ ÙŠÙ†Ø¨ØºÙŠ Ø£Ù† ØªØ³ØªØ³Ù„Ù… Ø¥Ù„Ø§ Ø¥Ø°Ø§ Ø£Ø¬Ø¨Ø±Øª Ø¹Ù„Ù‰ Ø°Ù„Ùƒ.", author: "Ø¥ÙŠÙ„ÙˆÙ† Ù…Ø§Ø³Ùƒ" },
            { img: "https://live.staticflickr.com/65535/49937378092_e3578c2c24_b.jpg", quote: "Ø§Ù„ÙØ´Ù„ Ø®ÙŠØ§Ø± Ù‡Ù†Ø§. Ø¥Ø°Ø§ Ù„Ù… ØªÙØ´Ù„ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ØŒ ÙØ£Ù†Øª Ù„Ø§ ØªØ¨ØªÙƒØ± Ø¨Ù…Ø§ ÙÙŠÙ‡ Ø§Ù„ÙƒÙØ§ÙŠØ©.", author: "Ø¥ÙŠÙ„ÙˆÙ† Ù…Ø§Ø³Ùƒ" },
            // Ø¬ÙŠÙ Ø¨ÙŠØ²ÙˆØ² - Ø£Ù…Ø§Ø²ÙˆÙ† ÙˆØ§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª
            { img: "https://upload.wikimedia.org/wikipedia/commons/b/b6/Amazon_Spheres_January_2019.jpg", quote: "Ø¥Ø°Ø§ Ø¶Ø§Ø¹ÙØª Ø¹Ø¯Ø¯ Ø§Ù„ØªØ¬Ø§Ø±Ø¨ Ø§Ù„ØªÙŠ ØªÙ‚ÙˆÙ… Ø¨Ù‡Ø§ Ø³Ù†ÙˆÙŠØ§Ù‹ØŒ ÙØ³ØªØ¶Ø§Ø¹Ù Ø¥Ø¨Ø¯Ø§Ø¹Ùƒ.", author: "Ø¬ÙŠÙ Ø¨ÙŠØ²ÙˆØ²" },
            { img: "https://upload.wikimedia.org/wikipedia/commons/a/a7/Blue_Origin_New_Shepard_Launch_NS-10.jpg", quote: "Ø§Ù„Ø°ÙƒØ§Ø¡ Ù‡Ùˆ Ù†Ø¹Ù…Ø©ØŒ Ø£Ù…Ø§ Ø§Ù„Ù„Ø·Ù ÙÙ‡Ùˆ Ø®ÙŠØ§Ø±.", author: "Ø¬ÙŠÙ Ø¨ÙŠØ²ÙˆØ²" },
            { img: "https://upload.wikimedia.org/wikipedia/commons/thumb/8/81/Amazon_Full_Moon.jpg/1280px-Amazon_Full_Moon.jpg", quote: "Ø§Ø¹Ù…Ù„ Ø¨Ø¬Ø¯ØŒ Ø§Ø³ØªÙ…ØªØ¹ Ø¨ÙˆÙ‚ØªÙƒØŒ ÙˆØ§ØµÙ†Ø¹ Ø§Ù„ØªØ§Ø±ÙŠØ®.", author: "Ø¬ÙŠÙ Ø¨ÙŠØ²ÙˆØ²" },
            { img: "https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/Amazon_Books_NYC.jpg/1280px-Amazon_Books_NYC.jpg", quote: "ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©ØŒ Ù†Ø­Ù† Ø®ÙŠØ§Ø±Ø§ØªÙ†Ø§. Ø§ØµÙ†Ø¹ Ù„Ù†ÙØ³Ùƒ Ù‚ØµØ© Ø¹Ø¸ÙŠÙ…Ø©.", author: "Ø¬ÙŠÙ Ø¨ÙŠØ²ÙˆØ²" },
            // ØªÙŠØ³Ù„Ø§ ÙˆØ§Ù„Ù…Ø²ÙŠØ¯
            { img: "https://upload.wikimedia.org/wikipedia/commons/e/e4/Tesla_Roadster_2.0_in_Switzerland_-_Front.jpg", quote: "Ø£Ø¹ØªÙ‚Ø¯ Ø£Ù†Ù‡ Ù…Ù† Ø§Ù„Ù…Ù…ÙƒÙ† Ù„Ù„Ù†Ø§Ø³ Ø§Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ† Ø£Ù† ÙŠØ®ØªØ§Ø±ÙˆØ§ Ø£Ù† ÙŠÙƒÙˆÙ†ÙˆØ§ Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠÙŠÙ†.", author: "Ø¥ÙŠÙ„ÙˆÙ† Ù…Ø§Ø³Ùƒ" },
            { img: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/0c/Tesla_Gigafactory_1_-_December_2019.jpg/1280px-Tesla_Gigafactory_1_-_December_2019.jpg", quote: "ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù„Ø¯ÙŠÙƒ Ø£Ø³Ø¨Ø§Ø¨ ØªØ¬Ø¹Ù„Ùƒ ØªÙ†Ù‡Ø¶ ÙÙŠ Ø§Ù„ØµØ¨Ø§Ø­ ÙˆØªØ±ØºØ¨ ÙÙŠ Ø§Ù„Ø¹ÙŠØ´.", author: "Ø¥ÙŠÙ„ÙˆÙ† Ù…Ø§Ø³Ùƒ" },
             // Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª Ø§Ù„Ù‚ÙˆÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù„ØªÙƒØ±Ø§Ø±
            { img: "https://upload.wikimedia.org/wikipedia/commons/9/92/SpaceX_Starship_SN8_launch_pad.jpg", quote: "Ø§Ù„Ø®Ø·Ø± Ø§Ù„Ø£ÙƒØ¨Ø± Ù‡Ùˆ Ø¹Ø¯Ù… Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø©.", author: "Ù…Ø§Ø±Ùƒ Ø²ÙˆÙƒØ±Ø¨ÙŠØ±Ø¬" },
            { img: "https://upload.wikimedia.org/wikipedia/commons/d/de/Falcon_Heavy_Demo_Mission_%2839337245145%29.jpg", quote: "Ù„Ø§ ÙŠÙ‡Ù…Ù†ÙŠ Ø£Ù† Ø£ÙƒÙˆÙ† Ø£ØºÙ†Ù‰ Ø±Ø¬Ù„ ÙÙŠ Ø§Ù„Ù…Ù‚Ø¨Ø±Ø©. Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„Ù†ÙˆÙ… Ù„ÙŠÙ„Ø§Ù‹ ÙˆÙ†Ø­Ù† Ù†Ù‚ÙˆÙ„ Ø£Ù†Ù†Ø§ ÙØ¹Ù„Ù†Ø§ Ø´ÙŠØ¦Ø§Ù‹ Ø±Ø§Ø¦Ø¹Ø§Ù‹.. Ù‡Ø°Ø§ Ù…Ø§ ÙŠÙ‡Ù…Ù†ÙŠ.", author: "Ø³ØªÙŠÙ Ø¬ÙˆØ¨Ø²" },
            { img: "https://upload.wikimedia.org/wikipedia/commons/b/b6/Amazon_Spheres_January_2019.jpg", quote: "Ø¥Ø°Ø§ ÙƒÙ†Øª Ù„Ø§ ØªØ³ØªØ·ÙŠØ¹ Ø§Ù„ØªØ³Ø§Ù…Ø­ Ù…Ø¹ Ø§Ù„Ù†Ù‚Ø¯ØŒ ÙÙ„Ø§ ØªÙØ¹Ù„ Ø£ÙŠ Ø´ÙŠØ¡ Ø¬Ø¯ÙŠØ¯ Ø£Ùˆ Ù…Ø«ÙŠØ± Ù„Ù„Ø§Ù‡ØªÙ…Ø§Ù….", author: "Ø¬ÙŠÙ Ø¨ÙŠØ²ÙˆØ²" },
            { img: "https://upload.wikimedia.org/wikipedia/commons/e/e4/Tesla_Roadster_2.0_in_Switzerland_-_Front.jpg", quote: "Ø§Ù„Ù†Ø§Ø³ ÙŠØ¹Ù…Ù„ÙˆÙ† Ø¨Ø´ÙƒÙ„ Ø£ÙØ¶Ù„ Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ¹Ø±ÙÙˆÙ† Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ù‡Ø¯Ù ÙˆÙ„Ù…Ø§Ø°Ø§.", author: "Ø¥ÙŠÙ„ÙˆÙ† Ù…Ø§Ø³Ùƒ" },
            { img: "https://upload.wikimedia.org/wikipedia/commons/a/a7/Blue_Origin_New_Shepard_Launch_NS-10.jpg", quote: "Ø£Ø­Ø¯ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø§Ù„ÙˆØ­ÙŠØ¯Ø© Ø§Ù„ØªÙŠ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù‡Ø§ ÙÙŠ Ø§Ù„Ø­ÙŠØ§Ø© Ù‡Ùˆ Ø¬Ù‡Ø¯Ùƒ.", author: "Ù…Ø§Ø±Ùƒ ÙƒÙˆØ¨Ø§Ù†" }
             // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø´Ø±Ø§Øª Ù‡Ù†Ø§.. Ø§Ù„Ù†Ø¸Ø§Ù… Ø³ÙŠØ¯ÙˆØ± Ø¨ÙŠÙ†Ù‡Ù… ÙŠÙˆÙ…ÙŠØ§Ù‹
        ];

        // --- 2. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… ---
        const daysEn = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        const daysAr = {'Sunday': 'Ø§Ù„Ø£Ø­Ø¯', 'Monday': 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Tuesday': 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Wednesday': 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Thursday': 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Friday': 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Saturday': 'Ø§Ù„Ø³Ø¨Øª'};
        const monthsAr = ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ', 'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'];

        let routine = JSON.parse(localStorage.getItem('routine_v8')) || {'Sunday': [], 'Monday': [], 'Tuesday': [], 'Wednesday': [], 'Thursday': [], 'Friday': [], 'Saturday': []};
        let history = JSON.parse(localStorage.getItem('history_v8')) || {};
        let currentPlanDay = '';
        let monthlyChart = null;

        window.onload = function() {
            setDailyInspiration(); // ØªØ¹ÙŠÙŠÙ† ØµÙˆØ±Ø© ÙˆØ§Ù‚ØªØ¨Ø§Ø³ Ø§Ù„ÙŠÙˆÙ…
            
            const now = new Date();
            const dayName = daysEn[now.getDay()];
            document.getElementById('headerDate').innerText = `${daysAr[dayName]} | ${now.toLocaleDateString('ar-SA')}`;
            currentPlanDay = dayName;

            renderDayScroller();
            renderRoutine();
            renderToday();
            initChart(); // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
            calculateMonthlyStats(); // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        };

        // --- 3. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¥Ù„Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ (ØºÙŠØ± Ù…ØªÙƒØ±Ø±) ---
        function setDailyInspiration() {
            const today = new Date();
            // Ø­Ø³Ø§Ø¨ Ø±Ù‚Ù… Ø§Ù„ÙŠÙˆÙ… ÙÙŠ Ø§Ù„Ø³Ù†Ø© (1-366)
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù‚Ø³Ù…Ø© Ù„ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª
            const index = dayOfYear % inspirationData.length;
            const data = inspirationData[index];

            document.getElementById('dailySketchBtn').src = data.img;
            document.getElementById('dailyQuote').innerText = `"${data.quote}"`;
            document.getElementById('dailyAuthor').innerText = `- ${data.author}`;
        }

        // --- 4. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ---
        function renderToday() {
            const now = new Date();
            const dayName = daysEn[now.getDay()];
            const dateKey = now.toLocaleDateString('en-CA');
            const list = document.getElementById('tasksContainer');
            const tasks = routine[dayName] || [];
            list.innerHTML = '';
            document.getElementById('emptyState').style.display = tasks.length === 0 ? 'block' : 'none';
            tasks.sort((a, b) => (a.time || '23:59').localeCompare(b.time || '23:59'));
            
            tasks.forEach(task => {
                const uid = `${dateKey}_${task.name}_${task.time}`;
                const isDone = history[uid] === true;
                const div = document.createElement('div');
                div.className = `task-card ${isDone ? 'done' : ''}`;
                div.innerHTML = `<div class="task-info"><h3>${task.name}</h3>${task.time ? `<span class="task-time">â° ${formatTime(task.time)}</span>` : ''}</div><button class="check-btn" onclick="toggleTask('${uid}')">âœ”</button>`;
                list.appendChild(div);
            });
        }

        function toggleTask(id) {
            history[id] = !history[id];
            localStorage.setItem('history_v8', JSON.stringify(history));
            renderToday();
            calculateMonthlyStats(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ù†Ø¯ ÙƒÙ„ ØªØºÙŠÙŠØ±
        }

        // --- 5. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ ---
        function renderDayScroller() {
            const box = document.getElementById('dayScroller'); box.innerHTML = '';
            const todayIdx = new Date().getDay();
            const sorted = [...daysEn.slice(todayIdx), ...daysEn.slice(0, todayIdx)];
            sorted.forEach(day => {
                const chip = document.createElement('div');
                chip.className = `day-chip ${day === currentPlanDay ? 'active' : ''}`;
                chip.innerText = daysAr[day];
                chip.onclick = () => { currentPlanDay = day; renderDayScroller(); renderRoutine(); };
                box.appendChild(chip);
            });
        }
        function renderRoutine() {
            document.getElementById('selectedDayLabel').innerText = daysAr[currentPlanDay];
            const list = document.getElementById('routineContainer');
            const tasks = routine[currentPlanDay] || [];
            list.innerHTML = '';
            if(tasks.length === 0) list.innerHTML = '<div style="color:#ccc; font-size:0.8rem; padding:10px;">ÙØ§Ø±Øº</div>';
            tasks.forEach((task, idx) => {
                const div = document.createElement('div'); div.className = 'routine-item';
                div.innerHTML = `<div><strong>${task.name}</strong> <small style="color:#aaa;">${formatTime(task.time)}</small></div><span class="btn-del" onclick="delTask(${idx})">Ø­Ø°Ù</span>`;
                list.appendChild(div);
            });
        }
        function addTask() {
            const name = document.getElementById('taskName').value.trim();
            const time = document.getElementById('taskTime').value;
            if(!name) return;
            routine[currentPlanDay].push({name, time});
            localStorage.setItem('routine_v8', JSON.stringify(routine));
            document.getElementById('taskName').value = ''; document.getElementById('taskTime').value = '';
            renderRoutine(); if(currentPlanDay === daysEn[new Date().getDay()]) { renderToday(); calculateMonthlyStats(); }
        }
        function delTask(idx) {
            if(confirm('Ø­Ø°ÙØŸ')) {
                routine[currentPlanDay].splice(idx, 1);
                localStorage.setItem('routine_v8', JSON.stringify(routine));
                renderRoutine(); if(currentPlanDay === daysEn[new Date().getDay()]) { renderToday(); calculateMonthlyStats(); }
            }
        }

        // --- 6. Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ© (Ø¬Ø¯ÙŠØ¯) ---
        function initChart() {
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            monthlyChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Ù…ÙƒØªÙ…Ù„', 'ÙØ§Ø¦Øª/Ù…ØªØ¨Ù‚ÙŠ'],
                    datasets: [{
                        data: [0, 1],
                        backgroundColor: ['#27ae60', '#e0e0e0'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    cutout: '75%',
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }

        function calculateMonthlyStats() {
            const now = new Date();
            const currentMonth = now.getMonth(); // 0-indexed
            const currentYear = now.getFullYear();
            document.getElementById('currentMonthName').innerText = monthsAr[currentMonth];

            let completedCount = 0;
            let totalScheduledCount = 0;

            // 1. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø± Ù…Ù† Ø§Ù„Ø³Ø¬Ù„
            for (let key in history) {
                if (history[key] === true) {
                    const datePart = key.split('_')[0]; // YYYY-MM-DD
                    const [year, month, day] = datePart.split('-').map(Number);
                    if (year === currentYear && month - 1 === currentMonth) {
                        completedCount++;
                    }
                }
            }

            // 2. Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„Ø© Ù„Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø§Ø¶ÙŠØ© Ù…Ù† Ø§Ù„Ø´Ù‡Ø± ÙˆØ­ØªÙ‰ Ø§Ù„ÙŠÙˆÙ…
            for (let d = 1; d <= now.getDate(); d++) {
                const tempDate = new Date(currentYear, currentMonth, d);
                const dayName = daysEn[tempDate.getDay()];
                totalScheduledCount += (routine[dayName] || []).length;
            }

            // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            const missedCount = Math.max(0, totalScheduledCount - completedCount);
            document.getElementById('totalDoneMonth').innerText = completedCount;
            document.getElementById('totalMissedMonth').innerText = missedCount;

            // 4. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
            if (monthlyChart) {
                if (totalScheduledCount === 0) {
                    monthlyChart.data.datasets[0].data = [0, 1]; // ØªØ¬Ù†Ø¨ Ø§Ù„Ù‚Ø³Ù…Ø© Ø¹Ù„Ù‰ ØµÙØ±
                    monthlyChart.data.datasets[0].backgroundColor = ['#27ae60', '#eee'];
                } else {
                    monthlyChart.data.datasets[0].data = [completedCount, missedCount];
                }
                monthlyChart.update();
            }
        }

        // --- Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ---
        function formatTime(t) { if(!t) return ''; let [h, m] = t.split(':'); let ampm = h >= 12 ? 'Ù…' : 'Øµ'; h = h % 12 || 12; return `${h}:${m} ${ampm}`; }
        function switchView(v) {
            document.querySelectorAll('.view-section').forEach(e => e.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(e => e.classList.remove('active'));
            document.getElementById('view' + v.charAt(0).toUpperCase() + v.slice(1)).classList.add('active');
            document.getElementById('btn' + v.charAt(0).toUpperCase() + v.slice(1)).classList.add('active');
            if(v === 'today') renderToday();
            if(v === 'stats') calculateMonthlyStats();
        }
    </script>
</body>
</html>

