<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±ÙˆØªÙŠÙ† Ø§Ù„Ø¹Ø¸Ù…Ø§Ø¡ - V9 Final</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        /* ÙŠÙ…Ù†Ø¹ Ø§Ù„Ù…ØªØµÙØ­ Ù…Ù† ØªØ±Ø¬Ù…Ø© Ø§Ù„ÙƒÙˆØ¯ */
        .notranslate { transform: translate(0); }

        :root {
            --bg-main: #f8f9fa;
            --bg-card: #ffffff;
            --text-primary: #111111;
            --text-secondary: #555555;
            --border-color: #dddddd;
            --accent-black: #000000;
            --success-green: #27ae60;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Cairo', sans-serif; }

        body {
            background-color: var(--bg-main); color: var(--text-primary);
            min-height: 100vh; display: flex; justify-content: center; padding-bottom: 90px;
        }

        .app-container {
            width: 100%; max-width: 600px; background: var(--bg-card); min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1); position: relative;
        }

        /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø³ÙƒØªØ´ (Ù…Ø­Ø³Ù†) --- */
        .sketch-header {
            position: relative;
            height: 300px;
            background: #222; /* Ù„ÙˆÙ† Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙÙŠ Ø­Ø§Ù„ ØªØ£Ø®Ø± Ø§Ù„ØµÙˆØ±Ø© */
            overflow: hidden;
            border-bottom: 4px solid var(--accent-black);
        }

        .sketch-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* ÙÙ„ØªØ± Ø³ÙƒØªØ´ Ù…ØªÙˆØ§Ø²Ù†: Ø£Ø¨ÙŠØ¶ ÙˆØ£Ø³ÙˆØ¯ Ù…Ø¹ ØªØ¨Ø§ÙŠÙ† */
            filter: grayscale(100%) contrast(120%) brightness(0.9);
            transition: transform 10s ease;
        }
        /* Ø­Ø±ÙƒØ© Ø¨Ø·ÙŠØ¦Ø© Ù„Ù„ØµÙˆØ±Ø© */
        .sketch-header:hover .sketch-img { transform: scale(1.1); }

        .quote-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%;
            background: linear-gradient(to top, #000000, transparent);
            padding: 25px 20px; color: #fff;
            text-align: center;
        }
        
        .quote-text { 
            font-size: 1.1rem; 
            font-weight: 700; 
            line-height: 1.6; 
            margin-bottom: 5px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }
        
        .quote-author { 
            font-size: 0.9rem; 
            color: #ddd; 
            font-weight: 400;
            letter-spacing: 1px;
        }

        .date-bar {
            background: #fff; padding: 12px; text-align: center; 
            border-bottom: 1px solid #eee; font-weight: 800; font-size: 1.1rem;
            letter-spacing: -0.5px;
        }

        /* --- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ --- */
        .view-section { display: none; padding: 20px; animation: fadeIn 0.4s; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from {opacity:0; transform: translateY(10px);} to {opacity:1; transform: translateY(0);} }

        /* ÙƒØ§Ø±Øª Ø§Ù„Ù…Ù‡Ù…Ø© */
        .task-card {
            display: flex; justify-content: space-between; align-items: center;
            padding: 18px; border: 1px solid #eee; border-radius: 16px;
            margin-bottom: 12px; background: #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.03);
            transition: 0.2s;
        }
        
        .task-info h3 { font-size: 1.1rem; font-weight: 700; margin-bottom: 4px; }
        .task-time { font-size: 0.85rem; color: #888; display: flex; align-items: center; gap: 5px; }

        .check-btn {
            width: 40px; height: 40px; border-radius: 50%; border: 2px solid #ddd;
            background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center;
            color: transparent; font-size: 1.3rem; transition: 0.2s;
        }
        .check-btn:hover { border-color: #000; }

        .task-card.done { background: #f8fff9; border-color: #c3e6cb; }
        .task-card.done h3 { text-decoration: line-through; color: #aaa; }
        .task-card.done .check-btn { background: var(--success-green); border-color: var(--success-green); color: white; }

        /* --- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª --- */
        .stats-box {
            background: #fff; padding: 30px; border-radius: 20px;
            border: 1px solid #eee; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }
        .chart-container { position: relative; height: 220px; width: 220px; margin: 0 auto 20px; }
        .stats-numbers { display: flex; justify-content: space-around; margin-top: 25px; padding-top: 20px; border-top: 1px solid #eee; }
        .stat-item h4 { font-size: 1.8rem; font-weight: 900; margin-bottom: 5px; }
        .stat-item span { color: #777; font-size: 0.9rem; }

        /* --- Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªØ­ÙƒÙ… --- */
        .day-scroller { display: flex; overflow-x: auto; gap: 10px; padding-bottom: 10px; margin-bottom: 20px; scrollbar-width: none; }
        .day-chip { padding: 10px 20px; background: #f1f1f1; border-radius: 50px; font-size: 0.9rem; white-space: nowrap; cursor: pointer; font-weight: 700; color: #555; transition: 0.2s; }
        .day-chip.active { background: #000; color: #fff; transform: scale(1.05); }

        .input-area { display: flex; gap: 10px; margin-bottom: 20px; }
        .input-area input { flex: 1; padding: 14px; border: 2px solid #eee; border-radius: 12px; outline: none; font-size: 1rem; }
        .input-area input:focus { border-color: #000; }
        .btn-add { background: #000; color: #fff; border: none; padding: 0 25px; border-radius: 12px; font-weight: bold; cursor: pointer; }

        .routine-row { display: flex; justify-content: space-between; padding: 15px; border-bottom: 1px solid #f5f5f5; align-items: center; }
        .btn-del { color: #ff4757; font-weight: bold; cursor: pointer; font-size: 0.9rem; }

        /* --- Ø§Ù„Ù†Ø§ÙØ¨Ø§Ø± --- */
        .navbar {
            position: fixed; bottom: 0; left: 0; width: 100%; background: #fff;
            border-top: 1px solid #eee; display: flex; justify-content: space-around; padding: 12px; z-index: 999;
        }
        .nav-btn { background: none; border: none; color: #bbb; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 4px; font-weight: 700; font-size: 0.8rem; }
        .nav-btn.active { color: #000; }
        .nav-icon { font-size: 1.4rem; margin-bottom: 2px; }

    </style>
</head>
<body>

    <div class="app-container">
        
        <div class="sketch-header">
            <img id="headerImage" src="" class="sketch-img" onerror="this.src='https://images.unsplash.com/photo-1516849841032-87cbac4d88f7?q=80&w=1000&auto=format&fit=crop'">
            <div class="quote-overlay">
                <p class="quote-text" id="headerQuote">...</p>
                <p class="quote-author" id="headerAuthor">...</p>
            </div>
        </div>

        <div class="date-bar" id="dateBar">--/--/----</div>

        <div id="viewToday" class="view-section active">
            <h2 style="margin-bottom: 20px;">Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ… ğŸ“</h2>
            <div id="tasksList"></div>
            <div id="emptyToday" style="text-align: center; margin-top: 50px; color: #999;">
                Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù….<br>Ø£Ø¶Ù Ø±ÙˆØªÙŠÙ†Ùƒ Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ ğŸ‘‡
            </div>
        </div>

        <div id="viewPlan" class="view-section">
            <h3 style="margin-bottom: 20px;">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ğŸ“…</h3>
            <div class="day-scroller" id="dayScroller"></div>
            
            <div class="input-area">
                <input type="text" id="taskInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©..." style="flex: 2;">
                <input type="time" id="timeInput" style="flex: 1;">
                <button class="btn-add" onclick="addTask()">+</button>
            </div>

            <div>
                <h4 style="margin-bottom: 10px; color: #777; font-size: 0.9rem;">Ø¬Ø¯ÙˆÙ„ ÙŠÙˆÙ… <span id="selectedDayName">--</span>:</h4>
                <div id="routineList"></div>
            </div>
        </div>

        <div id="viewStats" class="view-section">
            <h3 style="margin-bottom: 20px;">Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙƒ ğŸ“Š</h3>
            <div class="stats-box">
                <div class="chart-container">
                    <canvas id="myChart"></canvas>
                </div>
                <div class="stats-numbers">
                    <div class="stat-item">
                        <h4 id="statDone" style="color: var(--success-green)">0</h4>
                        <span>Ù…Ù†Ø¬Ø²Ø©</span>
                    </div>
                    <div class="stat-item">
                        <h4 id="statMissed" style="color: #ccc">0</h4>
                        <span>Ù…ØªØ¨Ù‚ÙŠØ©</span>
                    </div>
                </div>
                <p style="margin-top: 15px; font-size: 0.8rem; color: #999;">Ø£Ø¯Ø§Ø¤Ùƒ Ø®Ù„Ø§Ù„ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</p>
            </div>
        </div>

    </div>

    <div class="navbar">
        <button class="nav-btn active" onclick="switchTab('today')" id="navToday">
            <span class="nav-icon">âœ…</span> Ø§Ù„ÙŠÙˆÙ…
        </button>
        <button class="nav-btn" onclick="switchTab('plan')" id="navPlan">
            <span class="nav-icon">ğŸ“…</span> Ø§Ù„Ø¬Ø¯ÙˆÙ„
        </button>
        <button class="nav-btn" onclick="switchTab('stats')" id="navStats">
            <span class="nav-icon">ğŸ“ˆ</span> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        </button>
    </div>

    <script>
        // --- 1. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ØµÙˆØ± ÙˆØ±ÙˆØ§Ø¨Ø· Ù…ÙˆØ«ÙˆÙ‚Ø©) ---
        // Ø§Ø³ØªØ®Ø¯Ù…Ù†Ø§ Ø±ÙˆØ§Ø¨Ø· Unsplash Ù„Ø£Ù†Ù‡Ø§ Ø£Ø³Ø±Ø¹ ÙˆØ£Ù‚Ù„ Ø¹Ø±Ø¶Ø© Ù„Ù„Ø­Ø¬Ø¨
        const contentData = [
            {
                // Ø¥ÙŠÙ„ÙˆÙ† Ù…Ø§Ø³Ùƒ
                img: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/34/Elon_Musk_Royal_Society_%28crop2%29.jpg/800px-Elon_Musk_Royal_Society_%28crop2%29.jpg",
                quote: "Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ø´ÙŠØ¡ Ù…Ø§ Ù…Ù‡Ù…Ø§Ù‹ Ø¨Ù…Ø§ ÙÙŠÙ‡ Ø§Ù„ÙƒÙØ§ÙŠØ©ØŒ ÙØ¥Ù†Ùƒ ØªÙØ¹Ù„Ù‡ Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù†Øª Ø§Ù„Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª Ø¶Ø¯Ùƒ.",
                author: "Ø¥ÙŠÙ„ÙˆÙ† Ù…Ø§Ø³Ùƒ"
            },
            {
                // ØµØ§Ø±ÙˆØ® (Ø±Ù…Ø² Ù„Ù„Ø¥Ù†Ø¬Ø§Ø²)
                img: "https://images.unsplash.com/photo-1517976487492-5750f3195933?q=80&w=1000&auto=format&fit=crop",
                quote: "Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù‡ÙŠ Ø¥Ø«Ø¨Ø§Øª Ø£Ù† Ø§Ù„Ø´ÙŠØ¡ Ù…Ù…ÙƒÙ†.",
                author: "Ø¥ÙŠÙ„ÙˆÙ† Ù…Ø§Ø³Ùƒ"
            },
            {
                // Ø¬ÙŠÙ Ø¨ÙŠØ²ÙˆØ²
                img: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6c/Jeff_Bezos_at_Amazon_Spheres_Grand_Opening_in_Seattle_-_2018_%2839074799225%29_%28cropped%29.jpg/800px-Jeff_Bezos_at_Amazon_Spheres_Grand_Opening_in_Seattle_-_2018_%2839074799225%29_%28cropped%29.jpg",
                quote: "Ø¥Ø°Ø§ Ø¶Ø§Ø¹ÙØª Ø¹Ø¯Ø¯ Ø§Ù„ØªØ¬Ø§Ø±Ø¨ Ø§Ù„ØªÙŠ ØªÙ‚ÙˆÙ… Ø¨Ù‡Ø§ Ø³Ù†ÙˆÙŠØ§Ù‹ØŒ ÙØ³ØªØ¶Ø§Ø¹Ù Ø¥Ø¨Ø¯Ø§Ø¹Ùƒ.",
                author: "Ø¬ÙŠÙ Ø¨ÙŠØ²ÙˆØ²"
            },
            {
                // Ø³ÙŠØ§Ø±Ø© ØªÙŠØ³Ù„Ø§ (Ø±Ù…Ø² Ù„Ù„Ø§Ø¨ØªÙƒØ§Ø±)
                img: "https://images.unsplash.com/photo-1560958089-b8a1929cea89?q=80&w=1000&auto=format&fit=crop",
                quote: "Ø£Ø¹ØªÙ‚Ø¯ Ø£Ù†Ù‡ Ù…Ù† Ø§Ù„Ù…Ù…ÙƒÙ† Ù„Ù„Ù†Ø§Ø³ Ø§Ù„Ø¹Ø§Ø¯ÙŠÙŠÙ† Ø£Ù† ÙŠØ®ØªØ§Ø±ÙˆØ§ Ø£Ù† ÙŠÙƒÙˆÙ†ÙˆØ§ Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠÙŠÙ†.",
                author: "Ø¥ÙŠÙ„ÙˆÙ† Ù…Ø§Ø³Ùƒ"
            },
            {
                // ÙƒØªØ¨ (Ø±Ù…Ø² Ù„Ù„Ù…Ø¹Ø±ÙØ© - Ø¨ÙŠØ²ÙˆØ²)
                img: "https://images.unsplash.com/photo-1495446815901-a7297e633e8d?q=80&w=1000&auto=format&fit=crop",
                quote: "Ø§Ø¹Ù…Ù„ Ø¨Ø¬Ø¯ØŒ Ø§Ø³ØªÙ…ØªØ¹ Ø¨ÙˆÙ‚ØªÙƒØŒ ÙˆØ§ØµÙ†Ø¹ Ø§Ù„ØªØ§Ø±ÙŠØ®.",
                author: "Ø¬ÙŠÙ Ø¨ÙŠØ²ÙˆØ²"
            }
        ];

        const daysEn = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        const daysAr = {'Sunday': 'Ø§Ù„Ø£Ø­Ø¯', 'Monday': 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Tuesday': 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Wednesday': 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Thursday': 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Friday': 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Saturday': 'Ø§Ù„Ø³Ø¨Øª'};

        let routine = JSON.parse(localStorage.getItem('routine_v9')) || {'Sunday': [], 'Monday': [], 'Tuesday': [], 'Wednesday': [], 'Thursday': [], 'Friday': [], 'Saturday': []};
        let history = JSON.parse(localStorage.getItem('history_v9')) || {};
        let currentPlanDay = '';
        let chartInstance = null;

        // --- 2. Ø§Ù„ØªØ´ØºÙŠÙ„ ---
        window.onload = function() {
            loadDailyContent();
            
            const now = new Date();
            const dayName = daysEn[now.getDay()];
            document.getElementById('dateBar').innerText = `${daysAr[dayName]} | ${now.toLocaleDateString('ar-SA')}`;
            currentPlanDay = dayName;

            renderScroller();
            renderRoutine();
            renderToday();
            initChart();
            updateStats();
        };

        function loadDailyContent() {
            // Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­ØªÙˆÙ‰ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ… Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ
            const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
            const index = dayOfYear % contentData.length;
            const data = contentData[index];

            document.getElementById('headerImage').src = data.img;
            document.getElementById('headerQuote').innerText = `"${data.quote}"`;
            document.getElementById('headerAuthor').innerText = `- ${data.author}`;
        }

        // --- 3. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… ---
        function renderToday() {
            const now = new Date();
            const dayName = daysEn[now.getDay()];
            const dateKey = now.toLocaleDateString('en-CA');
            const list = document.getElementById('tasksList');
            const tasks = routine[dayName] || [];

            list.innerHTML = '';
            document.getElementById('emptyToday').style.display = tasks.length === 0 ? 'block' : 'none';

            tasks.sort((a, b) => (a.time || '23:59').localeCompare(b.time || '23:59'));

            tasks.forEach(task => {
                const uid = `${dateKey}_${task.name}_${task.time}`;
                const isDone = history[uid] === true;
                
                const div = document.createElement('div');
                div.className = `task-card ${isDone ? 'done' : ''}`;
                div.innerHTML = `
                    <div class="task-info">
                        <h3>${task.name}</h3>
                        ${task.time ? `<span class="task-time">â° ${tConvert(task.time)}</span>` : ''}
                    </div>
                    <button class="check-btn" onclick="toggleTask('${uid}')">âœ”</button>
                `;
                list.appendChild(div);
            });
        }

        function toggleTask(id) {
            history[id] = !history[id];
            localStorage.setItem('history_v9', JSON.stringify(history));
            renderToday();
            updateStats();
        }

        // --- 4. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„ ---
        function renderScroller() {
            const container = document.getElementById('dayScroller');
            container.innerHTML = '';
            const todayIdx = new Date().getDay();
            const sorted = [...daysEn.slice(todayIdx), ...daysEn.slice(0, todayIdx)];

            sorted.forEach(day => {
                const chip = document.createElement('div');
                chip.className = `day-chip ${day === currentPlanDay ? 'active' : ''}`;
                chip.innerText = daysAr[day];
                chip.onclick = () => { currentPlanDay = day; renderScroller(); renderRoutine(); };
                container.appendChild(chip);
            });
        }

        function renderRoutine() {
            document.getElementById('selectedDayName').innerText = daysAr[currentPlanDay];
            const list = document.getElementById('routineList');
            const tasks = routine[currentPlanDay] || [];
            list.innerHTML = '';
            
            if (tasks.length === 0) list.innerHTML = '<div style="color:#ccc; text-align:center; padding:10px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù…</div>';

            tasks.forEach((task, idx) => {
                const div = document.createElement('div');
                div.className = 'routine-row';
                div.innerHTML = `
                    <div><strong>${task.name}</strong> <small style="color:#aaa">${tConvert(task.time)}</small></div>
                    <span class="btn-del" onclick="delTask(${idx})">Ø­Ø°Ù</span>
                `;
                list.appendChild(div);
            });
        }

        function addTask() {
            const name = document.getElementById('taskInput').value.trim();
            const time = document.getElementById('timeInput').value;
            if(!name) return;

            routine[currentPlanDay].push({name, time});
            localStorage.setItem('routine_v9', JSON.stringify(routine));
            document.getElementById('taskInput').value = '';
            document.getElementById('timeInput').value = '';
            
            renderRoutine();
            if(currentPlanDay === daysEn[new Date().getDay()]) { renderToday(); updateStats(); }
        }

        function delTask(idx) {
            if(confirm('Ø­Ø°ÙØŸ')) {
                routine[currentPlanDay].splice(idx, 1);
                localStorage.setItem('routine_v9', JSON.stringify(routine));
                renderRoutine();
                if(currentPlanDay === daysEn[new Date().getDay()]) { renderToday(); updateStats(); }
            }
        }

        // --- 5. Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ---
        function initChart() {
            const ctx = document.getElementById('myChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Ù…Ù†Ø¬Ø²Ø©', 'Ù…ØªØ¨Ù‚ÙŠØ©'],
                    datasets: [{
                        data: [0, 1],
                        backgroundColor: ['#27ae60', '#eee'],
                        borderWidth: 0
                    }]
                },
                options: { cutout: '70%', responsive: true, plugins: { legend: { display: false } } }
            });
        }

        function updateStats() {
            // Ø­Ø³Ø§Ø¨ Ø¨Ø³ÙŠØ· Ù„Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
            const now = new Date();
            const currentMonth = now.getMonth();
            let done = 0;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù†Ø¬Ø²
            for(let key in history) {
                if(history[key]) {
                    const datePart = key.split('_')[0];
                    const [y, m, d] = datePart.split('-').map(Number);
                    if(m - 1 === currentMonth) done++;
                }
            }
            
            // ØªÙ‚Ø¯ÙŠØ± Ø¥Ø¬Ù…Ø§Ù„ÙŠ (Ù„Ù„Ø¹Ø±Ø¶ ÙÙ‚Ø· - ÙŠÙ…ÙƒÙ† ØªØ­Ø³ÙŠÙ†Ù‡ Ù„ÙŠÙƒÙˆÙ† Ø£ÙƒØ«Ø± Ø¯Ù‚Ø©)
            // Ø³Ù†ÙØªØ±Ø¶ Ø£Ù† Ø§Ù„Ù‡Ø¯Ù Ù‡Ùˆ Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ Ù„Ù„ÙŠÙˆÙ…
            const dayName = daysEn[now.getDay()];
            const todayTotal = (routine[dayName] || []).length;
            const todayDone = document.querySelectorAll('.task-card.done').length;
            const missed = Math.max(0, todayTotal - todayDone); // Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„ÙŠÙˆÙ…

            document.getElementById('statDone').innerText = done; // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´Ù‡Ø±
            document.getElementById('statMissed').innerText = missed; // Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„ÙŠÙˆÙ…

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø§Ø±Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ…
            if(chartInstance) {
                if(todayTotal === 0) {
                    chartInstance.data.datasets[0].data = [0, 1];
                } else {
                    chartInstance.data.datasets[0].data = [todayDone, missed];
                }
                chartInstance.update();
            }
        }

        // --- Ø£Ø¯ÙˆØ§Øª ---
        function tConvert (time) {
            if(!time) return '';
            time = time.toString ().match (/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/) || [time];
            if (time.length > 1) { 
                time = time.slice (1);  
                time[5] = +time[0] < 12 ? ' Øµ' : ' Ù…'; 
                time[0] = +time[0] % 12 || 12; 
            }
            return time.join (''); 
        }

        function switchTab(tab) {
            document.querySelectorAll('.view-section').forEach(e => e.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(e => e.classList.remove('active'));
            
            if(tab === 'today') {
                document.getElementById('viewToday').classList.add('active');
                document.getElementById('navToday').classList.add('active');
                renderToday();
            } else if(tab === 'plan') {
                document.getElementById('viewPlan').classList.add('active');
                document.getElementById('navPlan').classList.add('active');
            } else {
                document.getElementById('viewStats').classList.add('active');
                document.getElementById('navStats').classList.add('active');
                updateStats();
            }
        }
    </script>
</body>
</html>
