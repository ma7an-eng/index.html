<!DOCTYPE html>
<html lang="ar" dir="rtl" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Routinz">
    
    <link rel="apple-touch-icon" href="icon.jpg?v=12">
    <link rel="icon" type="image/jpg" href="icon.jpg?v=12">
    
    <title>Routinz</title>
    
    <link rel="manifest" href="data:application/manifest+json;charset=utf-8,%7B%22name%22%3A%22%D8%B1%D9%88%D8%AA%D9%8A%D9%86%D8%B2%22%2C%22short_name%22%3A%22Routinz%22%2C%22start_url%22%3A%22.%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23000000%22%2C%22theme_color%22%3A%22%23000000%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22icon.jpg%3Fv%3D12%22%2C%22sizes%22%3A%22512x512%22%2C%22type%22%3A%22image%2Fjpg%22%7D%5D%7D">
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Montserrat:wght@600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    
    <style>
        :root { 
            --bg-main: #000000; 
            --bg-card: #0a0a0a; 
            --text-primary: #ffffff; 
            --text-secondary: #888888; 
            --accent: #ff6b00; 
            --accent-glow: rgba(255, 107, 0, 0.9); 
            --accent-glow-light: rgba(255, 107, 0, 0.4);
            --success: #10b981; 
            --danger: #ef4444;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Cairo', sans-serif; background-color: var(--bg-main) !important; color: var(--text-primary); min-height: 100vh; display: flex; justify-content: center; padding-bottom: 90px; overscroll-behavior-y: none; user-select: none; }

        @keyframes gradientMove { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes pulseScale { from { transform: scale(1); filter: drop-shadow(0 0 10px var(--accent-glow-light)); } to { transform: scale(1.1); filter: drop-shadow(0 0 30px var(--accent)); } }
        @keyframes neonPulse { 0%, 100% { box-shadow: 0 0 10px var(--accent-glow-light), 0 0 20px var(--accent-glow-light); } 50% { box-shadow: 0 0 20px var(--accent-glow), 0 0 40px var(--accent); } }
        @keyframes textNeon { 0%, 100% { text-shadow: 0 0 5px var(--accent-glow-light); } 50% { text-shadow: 0 0 15px var(--accent-glow), 0 0 30px var(--accent); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        #splash-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000000 !important; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.6s ease-out, visibility 0.6s; }
        .splash-logo { width: 160px; height: auto; background: transparent; filter: drop-shadow(0 0 20px var(--accent-glow)); animation: pulseScale 2s infinite alternate; object-fit: contain; }

        .app-container { width: 100%; max-width: 600px; background: var(--bg-main); min-height: 100vh; position: relative; opacity: 0; animation: fadeIn 0.6s ease-out forwards 0.8s; }

        .hero-header { position: relative; height: 320px; background: linear-gradient(to top, #000000 15%, rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1517976487492-5750f3195933?q=80&w=1000&auto=format&fit=crop'); background-size: cover; background-position: center 60%; border-bottom-left-radius: 35px; border-bottom-right-radius: 35px; overflow: hidden; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; color: white; padding-bottom: 35px; }
        .hero-header::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 5px; background: var(--accent); box-shadow: 0 0 20px var(--accent), 0 0 40px var(--accent); }

        .streak-counter { position: absolute; top: 25px; inset-inline-start: 25px; background: rgba(0, 0, 0, 0.8); padding: 8px 18px; border-radius: 25px; border: 1px solid var(--accent); display: flex; align-items: center; gap: 10px; font-family: 'Montserrat', sans-serif; font-weight: 800; color: #fff; animation: neonPulse 3s infinite; backdrop-filter: blur(10px); direction: ltr; }
        .streak-fire { font-size: 1.3rem; animation: textNeon 2s infinite; }

        .lang-btn { position: absolute; top: 25px; inset-inline-end: 25px; background: rgba(0, 0, 0, 0.8); width: 45px; height: 45px; border-radius: 50%; border: 1px solid var(--accent); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; cursor: pointer; color: #fff; box-shadow: 0 0 15px var(--accent-glow-light); backdrop-filter: blur(10px); transition: all 0.3s; z-index: 100; }
        .lang-btn:hover { box-shadow: 0 0 25px var(--accent-glow); transform: scale(1.05); }

        .lang-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); z-index: 4000; visibility: hidden; opacity: 0; transition: all 0.3s ease; display: flex; justify-content: center; align-items: center; }
        .lang-modal-overlay.show { visibility: visible; opacity: 1; }
        .lang-modal { background: #0a0a0a; border: 1px solid var(--accent); border-radius: 25px; padding: 25px; width: 85%; max-width: 350px; box-shadow: 0 0 40px var(--accent-glow); transform: scale(0.9); transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .lang-modal-overlay.show .lang-modal { transform: scale(1); }
        .lang-option { display: flex; align-items: center; justify-content: space-between; padding: 15px 20px; border-radius: 15px; margin-bottom: 10px; cursor: pointer; border: 1px solid #222; transition: 0.3s; font-weight: 700; font-size: 1.1rem; }
        .lang-option:hover, .lang-option.active { border-color: var(--accent); background: rgba(255,107,0,0.1); box-shadow: 0 0 15px var(--accent-glow-light); }

        .hero-header h1 { font-family: 'Montserrat', sans-serif; font-size: 2.5rem; font-weight: 900; margin-bottom: 4px; text-shadow: 0 0 15px rgba(255,255,255,0.5); letter-spacing: 2px; }
        
        #headerDate { font-family: 'Montserrat', sans-serif; font-size: 1.1rem; font-weight: 900; letter-spacing: 2px; color: var(--accent); text-transform: uppercase; background: rgba(0, 0, 0, 0.7); padding: 10px 28px; border-radius: 30px; border: 1px solid var(--accent); box-shadow: 0 0 15px var(--accent-glow-light), inset 0 0 10px var(--accent-glow-light); direction: ltr; margin-bottom: 18px; animation: textNeon 3s infinite; }

        .daily-quote { font-family: 'Montserrat', sans-serif; font-size: 0.9rem; font-weight: 600; color: #aaa; text-align: center; max-width: 85%; line-height: 1.5; direction: ltr; font-style: italic; }

        .view-section { display: none; padding: 30px 22px; animation: fadeIn 0.4s ease-out; }
        .view-section.active { display: block; }
        
        .sortable-ghost { opacity: 0.5; background: var(--bg-card) !important; border: 2px dashed var(--accent) !important; box-shadow: 0 0 20px var(--accent-glow) inset !important; }

        .task-card { display: flex; justify-content: space-between; align-items: center; padding: 18px 22px; background: var(--bg-card); border-radius: 20px; margin-bottom: 18px; transition: all 0.3s ease; border: 1px solid #222; position: relative; overflow: hidden; }
        .task-card:hover { transform: translateY(-3px); border-color: var(--accent); box-shadow: 0 0 20px var(--accent-glow); }
        .task-card h3 { font-size: 1.15rem; font-weight: 700; color: var(--text-primary); margin-bottom: 4px; }
        
        .task-tag { font-size: 0.8rem; font-weight: 800; padding: 5px 12px; border-radius: 10px; margin-inline-start: 12px; background: rgba(255,255,255,0.05); display: inline-block; border: 1px solid transparent; }
        .task-meta { display: flex; align-items: center; margin-top: 6px; }
        .task-card small { font-family: 'Montserrat', sans-serif; color: var(--text-secondary); font-weight: 700; font-size: 0.9rem; letter-spacing: 1px; direction: ltr; display: inline-block; }
        
        .task-card.done { background: rgba(16, 185, 129, 0.05); border-color: var(--success); box-shadow: 0 0 15px rgba(16, 185, 129, 0.3); }
        .task-card.done h3, .task-card.done small, .task-card.done .task-tag { text-decoration: line-through; color: var(--success); opacity: 0.7; text-shadow: 0 0 8px rgba(16, 185, 129, 0.5); }

        .check-btn { width: 46px; height: 46px; min-width: 46px; border-radius: 50%; border: 2px solid var(--border-color); background: transparent; cursor: pointer; display: flex; align-items: center; justify-content: center; color: transparent; font-size: 1.4rem; transition: all 0.3s ease; }
        .task-card:hover .check-btn { border-color: var(--accent); box-shadow: 0 0 10px var(--accent-glow) inset; }
        .task-card.done .check-btn { background: var(--success); border-color: var(--success); color: white; box-shadow: 0 0 20px var(--success), 0 0 40px var(--success); }

        .stats-box { background: var(--bg-card); padding: 35px 25px; border-radius: 25px; text-align: center; margin-top: 15px; border: 1px solid #222; }
        .chart-container { position: relative; height: 240px; width: 100%; display: flex; justify-content: center; margin-bottom: 35px; filter: drop-shadow(0 0 15px rgba(16, 185, 129, 0.2)); }

        .day-scroller { display: flex; overflow-x: auto; gap: 12px; padding: 10px 5px 20px; margin-bottom: 25px; scrollbar-width: none; direction: ltr; mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent); -webkit-mask-image: linear-gradient(to right, transparent, black 5%, black 95%, transparent); }
        .day-scroller::-webkit-scrollbar { display: none; }
        .day-chip { font-family: 'Montserrat', sans-serif; padding: 14px 26px; background: var(--bg-card); border: 1px solid #222; border-radius: 35px; cursor: pointer; font-weight: 700; white-space: nowrap; color: var(--text-secondary); transition: all 0.3s ease; font-size: 0.95rem; text-transform: uppercase; letter-spacing: 1px; }
        .day-chip.active { background: #000; color: var(--accent); border-color: var(--accent); font-weight: 900; transform: translateY(-3px); box-shadow: 0 0 15px var(--accent-glow), inset 0 0 10px var(--accent-glow-light); text-shadow: 0 0 8px var(--accent); }
        
        .input-group { display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 30px; background: var(--bg-card); padding: 15px; border-radius: 20px; border: 1px solid #222; }
        .input-style { flex: 1; min-width: 120px; padding: 14px 18px; border: 1px solid #222; background: #000000; border-radius: 14px; font-size: 1rem; outline: none; color: var(--text-primary); font-weight: 600; font-family: inherit; transition: all 0.3s ease; }
        .input-style:focus { border-color: var(--accent); box-shadow: 0 0 15px var(--accent-glow); }
        .input-style::placeholder { color: var(--text-secondary); opacity: 0.5; }
        input[type="time"] { font-family: 'Montserrat', sans-serif; font-weight: 700; color: var(--accent); direction: ltr; }
        select.input-style { appearance: none; cursor: pointer; color: var(--text-primary); font-weight: 700; }
        select.input-style option { background: #000000; color: var(--text-primary); }
        
        .add-btn { width: 100%; color: #000; border: none; padding: 16px; border-radius: 16px; font-weight: 900; font-size: 1.2rem; cursor: pointer; transition: all 0.3s ease; background: var(--accent); box-shadow: 0 0 20px var(--accent-glow); }
        .add-btn:hover { box-shadow: 0 0 30px var(--accent); }

        .navbar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 92%; max-width: 550px; background: rgba(0, 0, 0, 0.95); backdrop-filter: blur(20px); display: flex; justify-content: space-around; padding: 15px 10px; z-index: 1000; border-radius: 25px; border: 1px solid #222; box-shadow: 0 10px 40px rgba(0,0,0,0.9); transition: flex-direction 0.3s; }
        .nav-btn { font-family: inherit; background: none; border: none; font-weight: 700; color: var(--text-secondary); cursor: pointer; font-size: 0.9rem; display: flex; flex-direction: column; align-items: center; transition: all 0.3s ease; opacity: 0.5; position: relative; }
        .nav-btn.active { color: var(--accent); opacity: 1; transform: translateY(-4px); animation: textNeon 2s infinite; } 
        .nav-icon { font-size: 1.7rem; margin-bottom: 6px; transition: transform 0.3s ease; display: block; filter: grayscale(100%); }
        .nav-btn.active .nav-icon { transform: translateY(-2px); filter: grayscale(0%) drop-shadow(0 0 10px var(--accent)); }

        /* --- ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ ØªÙ…Ø§Ù…Ø§Ù‹ Ù„Ø·Ù„Ø¨Ùƒ Ø§Ù„Ø£ÙˆÙ„ (V17) --- */
        .install-popup { 
            position: fixed; bottom: 0; left: 0; width: 100%; 
            background: rgba(0, 0, 0, 0.95); padding: 25px 20px; 
            border-top-left-radius: 25px; border-top-right-radius: 25px; 
            box-shadow: 0 0 40px var(--accent-glow); z-index: 3000; 
            display: none; /* ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø£ÙˆÙ„ ÙƒØ§Ù† display none ØµØ±ÙŠØ­ */
            text-align: center; animation: slideUp 0.5s ease; 
            border-top: 2px solid var(--accent); color: var(--text-primary); 
            backdrop-filter: blur(20px); 
        }
        @keyframes slideUp { from {transform: translateY(100%);} to {transform: translateY(0);} }
        .ios-arrow { animation: bounceArrow 1.5s infinite; font-size: 2.2rem; margin-top: 15px; display: block; color: var(--accent); filter: drop-shadow(0 0 10px var(--accent-glow)); }
        @keyframes bounceArrow { 0%, 100% {transform: translateY(0);} 50% {transform: translateY(10px);} }
        .btn-act { font-family: inherit; padding: 16px 30px; border: none; border-radius: 16px; font-weight: 900; cursor: pointer; font-size: 1.2rem; width: 100%; color: #000; background: var(--accent); transition: all 0.3s ease; box-shadow: 0 0 20px var(--accent), 0 0 40px var(--accent-glow); animation: neonPulse 2s infinite; }
        .btn-act:active { transform: scale(0.95); }

    </style>
</head>
<body>

    <div id="splash-screen">
        <img src="icon.jpg?v=12" class="splash-logo" alt="Routinz">
    </div>

    <div class="lang-modal-overlay" id="langModal">
        <div class="lang-modal" id="langModalContent">
            <h3 style="margin-bottom: 20px; text-align: center; color: var(--accent); text-shadow: 0 0 10px var(--accent-glow);">Select Language</h3>
            <div class="lang-option" onclick="setLanguage('ar')" id="btn-lang-ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
            <div class="lang-option" onclick="setLanguage('en')" id="btn-lang-en">ğŸ‡ºğŸ‡¸ English</div>
            <div class="lang-option" onclick="setLanguage('fr')" id="btn-lang-fr">ğŸ‡«ğŸ‡· FranÃ§ais</div>
            <button onclick="closeLangModal()" style="margin-top: 15px; width: 100%; padding: 12px; border-radius: 12px; background: #222; color: #fff; border: none; cursor: pointer; font-weight: bold;">Cancel</button>
        </div>
    </div>

    <div id="install-prompt" class="install-popup">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h3 style="margin:0; font-weight:900; color: var(--accent); font-size: 1.4rem; text-shadow: 0 0 10px var(--accent-glow);" id="txt-install-title">ğŸš€ ØªØ«Ø¨ÙŠØª Routinz</h3>
            <span onclick="closeInstallPrompt()" style="font-size:2rem; cursor:pointer; color:#888;">&times;</span>
        </div>
        
        <p id="txt-install-desc" style="color:var(--text-primary); font-size:1.1rem; margin-bottom:25px; font-weight: 600; line-height: 1.6;">
            Ø£Ø¶Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„ØªØ¬Ø±Ø¨Ø© Ø£Ø³Ø±Ø¹ ÙˆØ¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª.
        </p>

        <div id="ios-instruction" style="display:none; background:#111; padding:20px; border-radius:16px; border:1px dashed var(--accent); color: var(--text-primary); font-size: 1.1rem;">
            <span id="txt-ios-share">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</span> <span style="font-size:1.6rem; color:var(--accent);">â‹</span> <br> <span id="txt-ios-add" style="color:var(--accent); text-shadow: 0 0 10px var(--accent-glow); font-weight: 800;">Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            <span class="ios-arrow">â¬‡</span>
        </div>

        <button id="android-install-btn" class="btn-act" style="display:none; margin-top: 15px;"><span id="txt-install-btn">ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¢Ù†</span></button>
    </div>

    <div class="app-container">
        <div class="hero-header">
            <div class="lang-btn" onclick="openLangModal()">ğŸŒ</div>

            <div class="streak-counter">
                <span class="streak-fire">ğŸ”¥</span>
                <span id="streakCount">0</span>
            </div>
            
            <h1 id="mainTitle">ROUTINZ</h1>
            
            <p id="headerDate">--/--/----</p>
            <div class="daily-quote" id="dailyQuote">"Discipline equals freedom."</div>
        </div>

        <div id="viewToday" class="view-section active">
            <h2 class="section-title" id="txt-today-title">Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…</h2>
            <div id="tasksList"></div>
            <div id="emptyToday" style="text-align: center; margin-top: 80px; font-weight: 600;">
                <div style="font-size: 4rem; margin-bottom: 10px; opacity: 0.3;">âš¡</div>
                <div style="font-size: 1.2rem; margin-bottom: 5px; color: var(--text-secondary);" id="txt-empty-title">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹</div>
                <div style="font-size: 0.95rem; opacity: 0.6;" id="txt-empty-sub">Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ "Ø§Ù„Ø¬Ø¯ÙˆÙ„" Ù„Ù„Ø¨Ø¯Ø¡ Ø¨Ø§Ù„ØªØ®Ø·ÙŠØ·</div>
            </div>
        </div>

        <div id="viewPlan" class="view-section">
            <h3 class="section-title" id="txt-plan-title">ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…Ù‡Ø§Ù…</h3>
            <div class="day-scroller" id="dayScroller"></div>
            
            <div class="input-group">
                <input type="text" id="taskInput" class="input-style" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©..." style="flex: 2 1 200px;">
                
                <div style="display: flex; gap: 12px; flex: 3 1 300px;">
                    <select id="taskTag" class="input-style" style="flex:3;">
                        <option value="Ø¹Ø§Ù…">ğŸ¯ Ø¹Ø§Ù…</option>
                        <option value="Ø¨Ø±Ù…Ø¬Ø©">ğŸ§  Ø¨Ø±Ù…Ø¬Ø© Ùˆ AI</option>
                        <option value="ØªØµÙ…ÙŠÙ…">ğŸ¨ ØªØµÙ…ÙŠÙ…</option>
                        <option value="ØµØ­Ø©">ğŸ’ª ØµØ­Ø©</option>
                        <option value="Ø¨Ø²Ù†Ø³">ğŸ’¼ Ø¨Ø²Ù†Ø³</option>
                    </select>
                    <input type="time" id="timeInput" class="input-style" style="flex:2;">
                </div>
                
                <button onclick="addTask()" class="add-btn" id="txt-add-btn">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©</button>
            </div>
            
            <div id="txt-drag-hint" style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 15px; text-align: center; opacity: 0.7;">ğŸ’¡ Ù†ØµÙŠØ­Ø©: Ø±ØªØ¨ Ù…Ù‡Ø§Ù…Ùƒ Ø¨Ø³Ù‡ÙˆÙ„Ø© Ø¨Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª</div>
            <div id="routineList"></div>
        </div>

        <div id="viewStats" class="view-section">
            <h3 class="section-title" id="txt-stats-title">Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡</h3>
            <div class="stats-box">
                <div class="chart-container"><canvas id="myChart"></canvas></div>
                <div style="display:flex; justify-content:space-around; margin-top:25px; border-top: 1px solid #222; padding-top: 30px;">
                    <div>
                        <h3 id="statDone" style="font-family: 'Montserrat', sans-serif; color:var(--success); font-size: 2.5rem; margin:0; text-shadow: 0 0 20px var(--success);">0</h3>
                        <small style="color:var(--text-secondary); font-weight:700; font-size: 1rem;" id="txt-stat-done">Ù…ÙƒØªÙ…Ù„Ø©</small>
                    </div>
                    <div>
                        <h3 id="statMissed" style="font-family: 'Montserrat', sans-serif; color:var(--text-primary); font-size: 2.5rem; margin:0; opacity: 0.8;">0</h3>
                        <small style="color:var(--text-secondary); font-weight:700; font-size: 1rem;" id="txt-stat-missed">Ù…ØªØ¨Ù‚ÙŠØ©</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="navbar" id="navbar">
        <button class="nav-btn active" onclick="switchTab('today')" id="navToday"><span class="nav-icon">âš¡</span> <span id="txt-tab-today">Ø§Ù„ÙŠÙˆÙ…</span></button>
        <button class="nav-btn" onclick="switchTab('plan')" id="navPlan"><span class="nav-icon">ğŸ“…</span> <span id="txt-tab-plan">Ø§Ù„Ø¬Ø¯ÙˆÙ„</span></button>
        <button class="nav-btn" onclick="switchTab('stats')" id="navStats"><span class="nav-icon">ğŸ“ˆ</span> <span id="txt-tab-stats">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</span></button>
    </div>

    <script>
        const dict = {
            ar: {
                dir: "rtl", font: "'Cairo', sans-serif",
                todayTab: "Ø§Ù„ÙŠÙˆÙ…", planTab: "Ø§Ù„Ø¬Ø¯ÙˆÙ„", statsTab: "Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª",
                todayTitle: "Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…", emptyTitle: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹", emptySub: "Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ 'Ø§Ù„Ø¬Ø¯ÙˆÙ„' Ù„Ù„Ø¨Ø¯Ø¡ Ø¨Ø§Ù„ØªØ®Ø·ÙŠØ·",
                planTitle: "ØªØ®Ø·ÙŠØ· Ø§Ù„Ù…Ù‡Ø§Ù…", taskPlaceholder: "Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©...", addBtn: "Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©",
                dragHint: "ğŸ’¡ Ù†ØµÙŠØ­Ø©: Ø±ØªØ¨ Ù…Ù‡Ø§Ù…Ùƒ Ø¨Ø³Ù‡ÙˆÙ„Ø© Ø¨Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª",
                statsTitle: "Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡", done: "Ù…ÙƒØªÙ…Ù„Ø©", missed: "Ù…ØªØ¨Ù‚ÙŠØ©",
                installTitle: "ğŸš€ ØªØ«Ø¨ÙŠØª Routinz", installDesc: "Ø£Ø¶Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„ØªØ¬Ø±Ø¨Ø© Ø£Ø³Ø±Ø¹ ÙˆØ¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª.", installBtn: "ØªØ«Ø¨ÙŠØª Ø§Ù„Ø¢Ù†",
                iosShare: "Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©", iosAdd: "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
                tags: { "Ø¹Ø§Ù…": "ğŸ¯ Ø¹Ø§Ù…", "Ø¨Ø±Ù…Ø¬Ø©": "ğŸ§  Ø¨Ø±Ù…Ø¬Ø© Ùˆ AI", "ØªØµÙ…ÙŠÙ…": "ğŸ¨ ØªØµÙ…ÙŠÙ…", "ØµØ­Ø©": "ğŸ’ª ØµØ­Ø©", "Ø¨Ø²Ù†Ø³": "ğŸ’¼ Ø¨Ø²Ù†Ø³" },
                allDay: "Ø·ÙˆØ§Ù„ Ø§Ù„ÙŠÙˆÙ…"
            },
            en: {
                dir: "ltr", font: "'Montserrat', sans-serif",
                todayTab: "Today", planTab: "Plan", statsTab: "Stats",
                todayTitle: "Today's Tasks", emptyTitle: "No tasks currently", emptySub: "Go to 'Plan' to start planning",
                planTitle: "Task Planning", taskPlaceholder: "Next task name...", addBtn: "Add Task",
                dragHint: "ğŸ’¡ Tip: Drag & drop to reorder tasks",
                statsTitle: "Performance Stats", done: "Done", missed: "Remaining",
                installTitle: "ğŸš€ Install Routinz", installDesc: "Add the app to your home screen for a faster, offline experience.", installBtn: "Install Now",
                iosShare: "Tap the share button", iosAdd: "Add to Home Screen",
                tags: { "Ø¹Ø§Ù…": "ğŸ¯ General", "Ø¨Ø±Ù…Ø¬Ø©": "ğŸ§  Code & AI", "ØªØµÙ…ÙŠÙ…": "ğŸ¨ Design", "ØµØ­Ø©": "ğŸ’ª Health", "Ø¨Ø²Ù†Ø³": "ğŸ’¼ Business" },
                allDay: "ALL DAY"
            },
            fr: {
                dir: "ltr", font: "'Montserrat', sans-serif",
                todayTab: "Auj.", planTab: "Plan", statsTab: "Stats",
                todayTitle: "TÃ¢ches du jour", emptyTitle: "Aucune tÃ¢che", emptySub: "Allez Ã  'Plan' pour planifier",
                planTitle: "Planification", taskPlaceholder: "Nom de la tÃ¢che...", addBtn: "Ajouter la tÃ¢che",
                dragHint: "ğŸ’¡ Astuce: Glissez-dÃ©posez pour rÃ©organiser",
                statsTitle: "Statistiques", done: "TerminÃ©", missed: "Restant",
                installTitle: "ğŸš€ Installer Routinz", installDesc: "Ajoutez l'appli Ã  l'Ã©cran d'accueil pour une expÃ©rience hors ligne.", installBtn: "Installer",
                iosShare: "Appuyez sur partager", iosAdd: "Sur l'Ã©cran d'accueil",
                tags: { "Ø¹Ø§Ù…": "ğŸ¯ GÃ©nÃ©ral", "Ø¨Ø±Ù…Ø¬Ø©": "ğŸ§  Code & IA", "ØªØµÙ…ÙŠÙ…": "ğŸ¨ Design", "ØµØ­Ø©": "ğŸ’ª SantÃ©", "Ø¨Ø²Ù†Ø³": "ğŸ’¼ Affaires" },
                allDay: "TOUTE LA JOURNÃ‰E"
            }
        };

        let currentLang = localStorage.getItem('routinz_lang') || 'ar';
        const daysInternal = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

        function applyLanguage() {
            const data = dict[currentLang];
            document.getElementById('html-root').dir = data.dir;
            document.body.style.fontFamily = data.font;
            
            document.getElementById('txt-tab-today').innerText = data.todayTab;
            document.getElementById('txt-tab-plan').innerText = data.planTab;
            document.getElementById('txt-tab-stats').innerText = data.statsTab;
            document.getElementById('txt-today-title').innerText = data.todayTitle;
            document.getElementById('txt-empty-title').innerText = data.emptyTitle;
            document.getElementById('txt-empty-sub').innerText = data.emptySub;
            document.getElementById('txt-plan-title').innerText = data.planTitle;
            document.getElementById('taskInput').placeholder = data.taskPlaceholder;
            document.getElementById('txt-add-btn').innerText = data.addBtn;
            document.getElementById('txt-drag-hint').innerText = data.dragHint;
            document.getElementById('txt-stats-title').innerText = data.statsTitle;
            document.getElementById('txt-stat-done').innerText = data.done;
            document.getElementById('txt-stat-missed').innerText = data.missed;
            document.getElementById('txt-install-title').innerText = data.installTitle;
            document.getElementById('txt-install-desc').innerText = data.installDesc;
            document.getElementById('txt-install-btn').innerText = data.installBtn;
            document.getElementById('txt-ios-share').innerText = data.iosShare;
            document.getElementById('txt-ios-add').innerText = data.iosAdd;

            const selectTag = document.getElementById('taskTag');
            selectTag.innerHTML = '';
            for(let key in data.tags) { selectTag.innerHTML += `<option value="${key}">${data.tags[key]}</option>`; }

            const now = new Date();
            document.getElementById('headerDate').innerText = `${now.toLocaleDateString('en-US', { weekday: 'short' }).toUpperCase()} | ${now.toLocaleDateString('en-US', { month: 'short' }).toUpperCase()} ${now.getDate()}, ${now.getFullYear()}`;

            document.querySelectorAll('.lang-option').forEach(el => el.classList.remove('active'));
            document.getElementById('btn-lang-' + currentLang).classList.add('active');
            
            document.getElementById('navbar').style.flexDirection = data.dir === 'rtl' ? 'row' : 'row-reverse';

            renderScroller(); renderRoutine(); renderToday();
        }

        function setLanguage(langCode) { currentLang = langCode; localStorage.setItem('routinz_lang', langCode); applyLanguage(); closeLangModal(); }
        function openLangModal() { const m = document.getElementById('langModal'), c = document.getElementById('langModalContent'); m.style.display = 'flex'; setTimeout(() => { m.style.opacity = '1'; c.classList.add('show'); }, 10); }
        function closeLangModal() { const m = document.getElementById('langModal'), c = document.getElementById('langModalContent'); m.style.opacity = '0'; c.classList.remove('show'); setTimeout(() => { m.style.display = 'none'; }, 300); }

        // ==========================================
        // ÙƒÙˆØ¯ Ø§Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„Ø£ØµÙ„ÙŠ (Ù†Ø³Ø® Ù„ØµÙ‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ÙˆÙ„)
        // ==========================================
        let deferredPrompt;
        
        function checkInstall() {
            const isIos = /iphone|ipad|ipod/.test(window.navigator.userAgent.toLowerCase());
            const isInStandaloneMode = ('standalone' in window.navigator) && (window.navigator.standalone);
            
            if (!isInStandaloneMode && !window.matchMedia('(display-mode: standalone)').matches) {
                const prompt = document.getElementById('install-prompt');
                
                if (isIos) {
                    document.getElementById('ios-instruction').style.display = 'block';
                    document.getElementById('txt-install-desc').style.display = 'none';
                    document.getElementById('android-install-btn').style.display = 'none';
                    setTimeout(() => { prompt.style.display = 'block'; }, 3000); 
                }
            }
        }

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            const prompt = document.getElementById('install-prompt');
            const btn = document.getElementById('android-install-btn');
            
            document.getElementById('ios-instruction').style.display = 'none';
            document.getElementById('txt-install-desc').style.display = 'block';
            btn.style.display = 'block';
            prompt.style.display = 'block'; // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¸Ù‡ÙˆØ± Ø§Ù„Ù…Ø¨Ø§Ø´Ø± (Ù…Ø«Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ÙˆÙ„)

            btn.addEventListener('click', () => {
                prompt.style.display = 'none';
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    deferredPrompt = null;
                });
            });
        });

        function closeInstallPrompt() {
            document.getElementById('install-prompt').style.display = 'none';
        }
        // ==========================================

        const quotes = [ "\"Discipline equals freedom.\"", "\"We are what we repeatedly do.\"", "\"The future depends on what you do today.\"", "\"Don't stop when you're tired. Stop when you're done.\"", "\"Success is the sum of small efforts.\"" ];
        const successAudio = new Audio('https://www.myinstants.com/media/sounds/discord-notification.mp3');
        successAudio.volume = 0.5; successAudio.preload = 'auto'; 

        let routine = JSON.parse(localStorage.getItem('routinz_v40')) || {'Sunday': [], 'Monday': [], 'Tuesday': [], 'Wednesday': [], 'Thursday': [], 'Friday': [], 'Saturday': []};
        let history = JSON.parse(localStorage.getItem('history_routinz_v40')) || {};
        let currentPlanDay = '';
        let chartInstance = null;

        window.onload = function() {
            setTimeout(() => {
                const splash = document.getElementById('splash-screen');
                splash.style.opacity = '0';
                setTimeout(() => { 
                    splash.style.visibility = 'hidden'; 
                    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¨Ø¹Ø¯ Ø§Ø®ØªÙØ§Ø¡ Ø§Ù„Ø³Ø¨Ù„Ø§Ø´ (ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ÙˆÙ„)
                    checkInstall(); 
                }, 600);
            }, 2500);

            currentPlanDay = daysInternal[new Date().getDay()];
            document.getElementById('dailyQuote').innerText = quotes[new Date().getDate() % quotes.length];
            
            applyLanguage();

            new Sortable(document.getElementById('routineList'), {
                animation: 250, ghostClass: 'sortable-ghost', handle: '.task-card', 
                onEnd: function (evt) {
                    const item = routine[currentPlanDay].splice(evt.oldIndex, 1)[0];
                    routine[currentPlanDay].splice(evt.newIndex, 0, item);
                    localStorage.setItem('routinz_v40', JSON.stringify(routine));
                    if(currentPlanDay === daysInternal[new Date().getDay()]) renderToday();
                }
            });

            setTimeout(initChart, 600); setTimeout(updateStats, 700); updateStreakDisplay();
        };

        function playProfessionalDing() { try { if (navigator.vibrate) navigator.vibrate(30); successAudio.currentTime = 0; successAudio.play(); } catch(e) {} }

        let streakData = JSON.parse(localStorage.getItem('streak_routinz_v40')) || { count: 0, last100Date: null };
        function updateStreakDisplay() { document.getElementById('streakCount').innerText = streakData.count; }
        
        function checkDailyStreak(todayTotal, todayDone) {
            const todayStr = new Date().toLocaleDateString('en-CA');
            if (todayTotal > 0 && todayDone === todayTotal) {
                if (streakData.last100Date !== todayStr) {
                    let yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
                    streakData.count = (streakData.last100Date === yesterday.toLocaleDateString('en-CA')) ? streakData.count + 1 : 1;
                    streakData.last100Date = todayStr;
                    localStorage.setItem('streak_routinz_v40', JSON.stringify(streakData)); updateStreakDisplay();
                }
            } else if (streakData.last100Date === todayStr && todayDone < todayTotal) {
                let yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
                streakData.last100Date = yesterday.toLocaleDateString('en-CA');
                streakData.count = Math.max(0, streakData.count - 1);
                localStorage.setItem('streak_routinz_v40', JSON.stringify(streakData)); updateStreakDisplay();
            }
        }

        function getTagColor(tagKey) {
            if(!tagKey) return '';
            if(tagKey === 'Ø¨Ø±Ù…Ø¬Ø©') return 'color: #38bdf8; border-color: #38bdf8; box-shadow: 0 0 10px rgba(56,189,248,0.3);';
            if(tagKey === 'ØªØµÙ…ÙŠÙ…') return 'color: #c084fc; border-color: #c084fc; box-shadow: 0 0 10px rgba(192,132,252,0.3);';
            if(tagKey === 'ØµØ­Ø©') return 'color: #4ade80; border-color: #4ade80; box-shadow: 0 0 10px rgba(74,222,128,0.3);';
            if(tagKey === 'Ø¨Ø²Ù†Ø³') return 'color: #fcd34d; border-color: #fcd34d; box-shadow: 0 0 10px rgba(252,211,77,0.3);';
            return 'color: #94a3b8; border-color: #555;';
        }

        function renderToday() {
            const todayKey = daysInternal[new Date().getDay()];
            const dateKey = new Date().toLocaleDateString('en-CA');
            const list = document.getElementById('tasksList');
            if(!routine[todayKey]) routine[todayKey] = [];
            
            list.innerHTML = '';
            document.getElementById('emptyToday').style.display = routine[todayKey].length === 0 ? 'block' : 'none';
            
            routine[todayKey].forEach(task => {
                const uid = `${dateKey}_${task.name}_${task.time}`; const isDone = history[uid];
                const div = document.createElement('div'); div.className = `task-card ${isDone ? 'done' : ''}`;
                
                const tagDisplay = dict[currentLang].tags[task.tag] || dict[currentLang].tags['Ø¹Ø§Ù…'];
                const tagHtml = task.tag && task.tag !== 'Ø¹Ø§Ù…' ? `<span class="task-tag" style="${getTagColor(task.tag)}">${tagDisplay}</span>` : '';
                
                div.innerHTML = `<div style="flex:1;"><h3>${task.name}</h3><div class="task-meta"><small>${tConvert(task.time)}</small>${tagHtml}</div></div><button class="check-btn" onclick="toggleTask('${uid}')">âœ”</button>`;
                list.appendChild(div);
            });
        }
        
        function toggleTask(id) { history[id] = !history[id]; localStorage.setItem('history_routinz_v40', JSON.stringify(history)); if (history[id]) playProfessionalDing(); renderToday(); updateStats(); }
        
        function initChart() {
            const ctx = document.getElementById('myChart');
            if(ctx) {
                chartInstance = new Chart(ctx, {
                    type: 'doughnut', data: { labels: ['Done', 'Missed'], datasets: [{ data: [0, 1], backgroundColor: ['#10b981', '#111'], borderWidth: 0 }] },
                    options: { cutout: '80%', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, tooltip: { enabled: false } } }
                });
            }
        }
        
        function updateStats() {
            const todayTotal = (routine[daysInternal[new Date().getDay()]] || []).length;
            const todayDone = document.querySelectorAll('#viewToday .task-card.done').length;
            const missed = Math.max(0, todayTotal - todayDone);
            document.getElementById('statDone').innerText = todayDone; document.getElementById('statMissed').innerText = missed;
            if(chartInstance) { chartInstance.data.datasets[0].data = todayTotal === 0 ? [0, 1] : [todayDone, missed]; chartInstance.update(); }
            checkDailyStreak(todayTotal, todayDone);
        }

        function renderScroller() {
            const box = document.getElementById('dayScroller'); box.innerHTML = '';
            const todayIdx = new Date().getDay();
            const sortedDays = [...daysInternal.slice(todayIdx), ...daysInternal.slice(0, todayIdx)];
            sortedDays.forEach(day => {
                const chip = document.createElement('div'); chip.className = `day-chip ${day === currentPlanDay ? 'active' : ''}`; chip.innerText = day.substring(0, 3).toUpperCase();
                chip.onclick = () => { currentPlanDay = day; renderScroller(); renderRoutine(); }; box.appendChild(chip);
            });
        }

        function renderRoutine() {
            const list = document.getElementById('routineList');
            if(!routine[currentPlanDay]) routine[currentPlanDay] = [];
            list.innerHTML = '';
            routine[currentPlanDay].forEach((task, idx) => {
                const tagDisplay = dict[currentLang].tags[task.tag] || dict[currentLang].tags['Ø¹Ø§Ù…'];
                const tagHtml = task.tag && task.tag !== 'Ø¹Ø§Ù…' ? `<span class="task-tag" style="${getTagColor(task.tag)}">${tagDisplay}</span>` : '';
                list.innerHTML += `<div class="task-card" style="cursor: grab;"><div style="flex:1;"><div style="font-weight:700; color:var(--text-primary); margin-bottom:2px;">${task.name}</div><div class="task-meta"><small style="color:var(--text-secondary);">${tConvert(task.time)}</small>${tagHtml}</div></div><div onclick="delTask(${idx})" style="color:var(--danger); background:rgba(239, 68, 68, 0.1); width:35px; height:35px; display:flex; align-items:center; justify-content:center; border-radius:10px; cursor:pointer; font-weight:bold;">âœ•</div></div>`;
            });
        }

        function addTask() {
            const name = document.getElementById('taskInput').value, time = document.getElementById('timeInput').value, tag = document.getElementById('taskTag').value;
            if(!name) return;
            if(!routine[currentPlanDay]) routine[currentPlanDay] = [];
            routine[currentPlanDay].push({name, time, tag}); localStorage.setItem('routinz_v40', JSON.stringify(routine));
            document.getElementById('taskInput').value = ''; document.getElementById('timeInput').value = '';
            renderRoutine(); if(currentPlanDay === daysInternal[new Date().getDay()]) { renderToday(); updateStats(); }
        }

        function delTask(idx) { routine[currentPlanDay].splice(idx, 1); localStorage.setItem('routinz_v40', JSON.stringify(routine)); renderRoutine(); if(currentPlanDay === daysInternal[new Date().getDay()]) { renderToday(); updateStats(); } }

        function tConvert(time) {
            if(!time) return dict[currentLang].allDay; 
            time = time.toString().match(/^([01]\d|2[0-3])(:)([0-5]\d)(:[0-5]\d)?$/) || [time];
            if (time.length > 1) { time = time.slice(1); time[5] = +time[0] < 12 ? ' AM' : ' PM'; time[0] = +time[0] % 12 || 12; } return time.join('');
        }

        function switchTab(t) {
            document.querySelectorAll('.view-section, .nav-btn').forEach(e => e.classList.remove('active'));
            if(t==='today'){document.getElementById('viewToday').classList.add('active');document.getElementById('navToday').classList.add('active');renderToday();}
            else if(t==='plan'){document.getElementById('viewPlan').classList.add('active');document.getElementById('navPlan').classList.add('active');}
            else{document.getElementById('viewStats').classList.add('active');document.getElementById('navStats').classList.add('active');updateStats();}
        }
    </script>
</body>
</html>
