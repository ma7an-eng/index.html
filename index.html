<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¯ÙŠØ± Ø§Ù„Ø±ÙˆØªÙŠÙ† Ø§Ù„Ø°ÙƒÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #ff6b35; /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
            --dark: #2d3436;    /* Ø£Ø³ÙˆØ¯ Ø±Ù…Ø§Ø¯ÙŠ */
            --light: #f5f6fa;   /* Ø®Ù„ÙÙŠØ© ÙØ§ØªØ­Ø© */
            --success: #00b894; /* Ø£Ø®Ø¶Ø± Ù„Ù„Ø¥Ù†Ø¬Ø§Ø² */
            --danger: #d63031;  /* Ø£Ø­Ù…Ø± Ù„Ù„Ø­Ø°Ù */
            --white: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }

        body {
            background-color: var(--light);
            color: var(--dark);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 80px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ */
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            overflow: hidden;
            min-height: 80vh;
            position: relative;
        }

        /* --- Ø§Ù„Ø±Ø£Ø³ --- */
        .header {
            background: var(--dark);
            color: white;
            padding: 25px;
            text-align: center;
            border-bottom: 5px solid var(--primary);
        }
        .header h1 { font-size: 1.5rem; margin-bottom: 5px; }
        .date-display { color: var(--primary); font-weight: bold; font-size: 0.9rem; }

        /* --- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©) --- */
        .main-view { padding: 20px; display: block; }
        .hidden { display: none !important; }

        .progress-card {
            background: #fff3e0;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .chart-box { width: 60px; height: 60px; }
        .progress-text { font-weight: bold; color: var(--primary); font-size: 1.1rem; }

        .task-list { list-style: none; padding-bottom: 20px; }

        .task-card {
            background: white;
            border: 2px solid #eee;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            transition: 0.3s;
        }

        .task-card.done {
            background: #f0fff4;
            border-color: var(--success);
            opacity: 0.8;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-time {
            background: var(--dark);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .task-title { font-size: 1.2rem; font-weight: 700; }

        /* Ø§Ù„Ø²Ø± Ø§Ù„ÙƒØ¨ÙŠØ± Ù„Ù„Ø¥Ù†Ø¬Ø§Ø² */
        .btn-complete {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .state-pending {
            background: #eee;
            color: #777;
        }
        .state-pending:hover { background: #e0e0e0; }

        .state-done {
            background: var(--success);
            color: white;
        }

        /* --- Ø´Ø§Ø´Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Settings) --- */
        .schedule-view { padding: 20px; }
        
        .day-selector {
            display: flex;
            gap: 5px;
            overflow-x: auto;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .day-btn {
            background: #eee;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            white-space: nowrap;
            cursor: pointer;
            font-weight: bold;
        }
        .day-btn.active {
            background: var(--primary);
            color: white;
        }

        .input-box {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px dashed #ccc;
        }
        .input-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .input-row input {
            padding: 10px; border: 1px solid #ddd; border-radius: 8px; width: 100%;
        }
        .btn-add {
            background: var(--dark); color: white; border: none; padding: 10px 20px;
            border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold;
        }

        .edit-list-item {
            display: flex; justify-content: space-between; align-items: center;
            background: white; padding: 10px; border-bottom: 1px solid #eee;
        }
        .btn-del-small {
            background: #ffecec; color: var(--danger); border: none;
            width: 30px; height: 30px; border-radius: 50%; cursor: pointer;
        }

        /* --- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙÙ„ÙŠØ© Ù„Ù„ØªÙ†Ù‚Ù„ --- */
        .bottom-nav {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            border-radius: 50px;
            padding: 10px 20px;
            display: flex;
            gap: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            z-index: 100;
        }

        .nav-btn {
            background: none;
            border: none;
            color: #888;
            font-size: 0.9rem;
            cursor: pointer;
            padding: 5px 15px;
            border-radius: 20px;
            transition: 0.3s;
        }

        .nav-btn.active {
            background: var(--primary);
            color: white;
            font-weight: bold;
        }

        /* --- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø§Ø­ØªÙØ§Ù„ (Modal) --- */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 200; display: none;
            align-items: center; justify-content: center; backdrop-filter: blur(5px);
        }
        .modal.show { display: flex; }
        .modal-content {
            background: white; width: 90%; max-width: 400px; padding: 30px;
            border-radius: 20px; text-align: center; border-top: 8px solid var(--primary);
        }
        .modal-btn {
            background: var(--dark); color: white; border: none; padding: 10px 30px;
            border-radius: 50px; margin-top: 20px; cursor: pointer;
        }

    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1 id="pageTitle">Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…</h1>
            <div class="date-display" id="dateDisplay">--/--/----</div>
        </div>

        <div id="viewToday" class="main-view">
            <div class="progress-card">
                <div>
                    <div style="font-size: 0.8rem; color: #777;">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</div>
                    <div class="progress-text" id="progressText">0%</div>
                </div>
                <div class="chart-box">
                    <canvas id="todayChart"></canvas>
                </div>
            </div>

            <ul class="task-list" id="todayList">
                </ul>
            
            <div id="emptyToday" style="text-align: center; color: #aaa; margin-top: 30px; display: none;">
                Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù…Ø¬Ø¯ÙˆÙ„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ….<br>
                Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„" Ù„Ø¥Ø¶Ø§ÙØ© Ø±ÙˆØªÙŠÙ†Ùƒ! ğŸ“…
            </div>
        </div>

        <div id="viewPlan" class="schedule-view hidden">
            <h3 style="margin-bottom: 10px;">Ø§Ø®ØªØ± Ø§Ù„ÙŠÙˆÙ… Ù„Ù„ØªØ¹Ø¯ÙŠÙ„:</h3>
            <div class="day-selector">
                <button class="day-btn active" onclick="selectDay('Saturday')">Ø§Ù„Ø³Ø¨Øª</button>
                <button class="day-btn" onclick="selectDay('Sunday')">Ø§Ù„Ø£Ø­Ø¯</button>
                <button class="day-btn" onclick="selectDay('Monday')">Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†</button>
                <button class="day-btn" onclick="selectDay('Tuesday')">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</button>
                <button class="day-btn" onclick="selectDay('Wednesday')">Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</button>
                <button class="day-btn" onclick="selectDay('Thursday')">Ø§Ù„Ø®Ù…ÙŠØ³</button>
                <button class="day-btn" onclick="selectDay('Friday')">Ø§Ù„Ø¬Ù…Ø¹Ø©</button>
            </div>

            <div class="input-box">
                <h4>Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø±ÙˆØªÙŠÙ†ÙŠØ© Ù„Ù€ <span id="selectedDayName" style="color:var(--primary)">Ø§Ù„Ø³Ø¨Øª</span>:</h4>
                <div class="input-row">
                    <input type="text" id="planTaskInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø© (Ù…Ø«Ø§Ù„: Ø±ÙŠØ§Ø¶Ø©)">
                    <input type="time" id="planTimeInput" style="width: 100px;">
                </div>
                <button class="btn-add" onclick="addToRoutine()">+ Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
            </div>

            <div style="background: white; border-radius: 15px; border: 1px solid #eee; overflow: hidden;">
                <h4 style="padding: 10px; background: #f5f5f5; border-bottom: 1px solid #eee;">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…:</h4>
                <div id="routineList"></div>
            </div>
        </div>

    </div>

    <div class="bottom-nav">
        <button class="nav-btn active" id="btnNavToday" onclick="switchView('today')">ğŸ“ Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…</button>
        <button class="nav-btn" id="btnNavPlan" onclick="switchView('plan')">âš™ï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</button>
    </div>

    <div class="modal" id="celebrationModal">
        <div class="modal-content">
            <h1 style="font-size: 3rem;">ğŸ‰</h1>
            <h2>Ø£Ø¯Ø§Ø¡ Ø£Ø³Ø·ÙˆØ±ÙŠ!</h2>
            <p style="color: #666; margin: 10px 0;">Ù„Ù‚Ø¯ Ø³Ø­Ù‚Øª Ø¬Ù…ÙŠØ¹ Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ….</p>
            <div style="background: #fff8e1; padding: 10px; border-radius: 10px; margin: 15px 0; font-style: italic;" id="quoteText">
                "Ø§Ù‚ØªØ¨Ø§Ø³ Ø§Ù„ØªØ´Ø¬ÙŠØ¹"
            </div>
            <button class="modal-btn" onclick="closeModal()">Ø§Ø³ØªÙ…Ø±Ø§Ø±</button>
        </div>
    </div>

    <script>
        // --- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
        // Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ù„Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ù…Ø¹ Ø§Ù„Ù†Ø¸Ø§Ù…
        const daysMap = {
            0: 'Sunday', 1: 'Monday', 2: 'Tuesday', 3: 'Wednesday', 4: 'Thursday', 5: 'Friday', 6: 'Saturday'
        };
        const daysAr = {
            'Sunday': 'Ø§Ù„Ø£Ø­Ø¯', 'Monday': 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Tuesday': 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Wednesday': 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Thursday': 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Friday': 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Saturday': 'Ø§Ù„Ø³Ø¨Øª'
        };

        // Ø§Ù„Ø°Ø§ÙƒØ±Ø©: 
        // 1. routine: Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø«Ø§Ø¨Øª (Ù…Ø§Ø°Ø§ Ø£ÙØ¹Ù„ ÙƒÙ„ Ø³Ø¨ØªØŸ)
        // 2. dailyHistory: Ø³Ø¬Ù„ ÙƒÙ„ ÙŠÙˆÙ… Ø¨ØªØ§Ø±ÙŠØ®Ù‡ (Ù…Ø§Ø°Ø§ ÙØ¹Ù„Øª ÙŠÙˆÙ… 2026-01-24ØŸ)
        let routine = JSON.parse(localStorage.getItem('myRoutine')) || {
            'Saturday': [], 'Sunday': [], 'Monday': [], 'Tuesday': [], 'Wednesday': [], 'Thursday': [], 'Friday': []
        };
        
        let dailyHistory = JSON.parse(localStorage.getItem('myDailyHistory')) || {};

        let currentViewDay = 'Saturday'; // Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø®ØªØ§Ø± ÙÙŠ ØµÙØ­Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        let myChart = null;

        // --- Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ ---
        window.onload = function() {
            initApp();
        };

        function initApp() {
            const todayDate = new Date().toLocaleDateString('en-CA'); // ØµÙŠØºØ© YYYY-MM-DD
            const todayDayName = daysMap[new Date().getDay()]; // Ù…Ø«Ù„Ø§ Sunday

            document.getElementById('dateDisplay').innerText = `${daysAr[todayDayName]} | ${todayDate}`;

            // Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„ Ù„Ù„ÙŠÙˆÙ…ØŸ Ø¥Ø°Ø§ Ù„Ø§ØŒ Ø§Ù†Ø³Ø®Ù‡ Ù…Ù† Ø§Ù„Ø±ÙˆØªÙŠÙ†
            if (!dailyHistory[todayDate]) {
                // Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ù…Ù‡Ø§Ù… Ù…Ù† Ø§Ù„Ø±ÙˆØªÙŠÙ† Ù„Ù„ÙŠÙˆÙ…
                dailyHistory[todayDate] = JSON.parse(JSON.stringify(routine[todayDayName] || []));
                saveData();
            }

            renderToday(todayDate);
            initChart();
            updateChart(todayDate);
        }

        function saveData() {
            localStorage.setItem('myRoutine', JSON.stringify(routine));
            localStorage.setItem('myDailyHistory', JSON.stringify(dailyHistory));
        }

        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¹Ø±Ø¶ (ØµÙØ­Ø© Ø§Ù„ÙŠÙˆÙ…) ---
        function renderToday(dateKey) {
            const list = document.getElementById('todayList');
            const tasks = dailyHistory[dateKey] || [];
            
            list.innerHTML = '';
            
            if (tasks.length === 0) {
                document.getElementById('emptyToday').style.display = 'block';
            } else {
                document.getElementById('emptyToday').style.display = 'none';
            }

            // ØªØ±ØªÙŠØ¨: ØºÙŠØ± Ø§Ù„Ù…ÙƒØªÙ…Ù„ Ø£ÙˆÙ„Ø§Ù‹
            tasks.sort((a, b) => a.completed - b.completed);

            tasks.forEach((task, index) => {
                const li = document.createElement('li');
                li.className = `task-card ${task.completed ? 'done' : ''}`;
                li.innerHTML = `
                    <div class="task-header">
                        <span class="task-title">${task.text}</span>
                        ${task.time ? `<span class="task-time">${formatTime(task.time)}</span>` : ''}
                    </div>
                    <button class="btn-complete ${task.completed ? 'state-done' : 'state-pending'}" 
                            onclick="toggleTodayTask('${dateKey}', ${index})">
                        ${task.completed ? 'âœ” ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²' : 'â—‹ Ø§Ø¶ØºØ· Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡'}
                    </button>
                `;
                list.appendChild(li);
            });
        }

        function toggleTodayTask(dateKey, index) {
            dailyHistory[dateKey][index].completed = !dailyHistory[dateKey][index].completed;
            saveData();
            renderToday(dateKey);
            updateChart(dateKey);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
            const allDone = dailyHistory[dateKey].every(t => t.completed);
            if (allDone && dailyHistory[dateKey].length > 0) {
                showCelebration();
            }
        }

        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (ØµÙØ­Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„) ---
        function switchView(viewName) {
            const todayView = document.getElementById('viewToday');
            const planView = document.getElementById('viewPlan');
            const btnToday = document.getElementById('btnNavToday');
            const btnPlan = document.getElementById('btnNavPlan');
            const title = document.getElementById('pageTitle');

            if (viewName === 'today') {
                todayView.classList.remove('hidden');
                planView.classList.add('hidden');
                btnToday.classList.add('active');
                btnPlan.classList.remove('active');
                title.innerText = "Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…";
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ… Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
                initApp();
            } else {
                todayView.classList.add('hidden');
                planView.classList.remove('hidden');
                btnToday.classList.remove('active');
                btnPlan.classList.add('active');
                title.innerText = "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±ÙˆØªÙŠÙ† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ";
                selectDay(currentViewDay); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø®ØªØ§Ø±
            }
        }

        function selectDay(dayName) {
            currentViewDay = dayName;
            
            // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£ÙŠØ§Ù…
            document.querySelectorAll('.day-btn').forEach(btn => btn.classList.remove('active'));
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø²Ø± Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚ ÙˆØªÙØ¹ÙŠÙ„Ù‡ (Ø¨Ø³ÙŠØ·)
            const btns = document.querySelectorAll('.day-btn');
            btns.forEach(b => {
                if(b.innerText === daysAr[dayName]) b.classList.add('active');
            });

            document.getElementById('selectedDayName').innerText = daysAr[dayName];
            renderRoutineList();
        }

        function addToRoutine() {
            const input = document.getElementById('planTaskInput');
            const time = document.getElementById('planTimeInput');
            
            if (!input.value) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø©!");

            routine[currentViewDay].push({
                text: input.value,
                time: time.value,
                completed: false
            });

            saveData();
            renderRoutineList();
            input.value = '';
            time.value = '';
            
            alert(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© "${input.value}" Ù„Ø±ÙˆØªÙŠÙ† ÙŠÙˆÙ… ${daysAr[currentViewDay]}.\nØ³ØªØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©!`);
        }

        function removeFromRoutine(index) {
            if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ù…Ø© Ù…Ù† Ø§Ù„Ø±ÙˆØªÙŠÙ†ØŸ Ù„Ù† ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.")) {
                routine[currentViewDay].splice(index, 1);
                saveData();
                renderRoutineList();
            }
        }

        function renderRoutineList() {
            const listContainer = document.getElementById('routineList');
            const tasks = routine[currentViewDay] || [];
            listContainer.innerHTML = '';

            if(tasks.length === 0) {
                listContainer.innerHTML = '<div style="padding:20px; text-align:center; color:#999">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±ÙˆØªÙŠÙ† Ù…Ø³Ø¬Ù„ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</div>';
                return;
            }

            tasks.forEach((task, index) => {
                const div = document.createElement('div');
                div.className = 'edit-list-item';
                div.innerHTML = `
                    <div>
                        <strong>${task.text}</strong> 
                        ${task.time ? `<small style="color:var(--primary)">(${formatTime(task.time)})</small>` : ''}
                    </div>
                    <button class="btn-del-small" onclick="removeFromRoutine(${index})">âœ•</button>
                `;
                listContainer.appendChild(div);
            });
        }

        // --- Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ÙˆØ´Ø§Ø±Øª ---
        function formatTime(t) {
            let [h, m] = t.split(':');
            let ampm = h >= 12 ? 'Ù…' : 'Øµ';
            h = h % 12 || 12;
            return `${h}:${m} ${ampm}`;
        }

        function initChart() {
            const ctx = document.getElementById('todayChart').getContext('2d');
            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Ù…Ù†Ø¬Ø²', 'Ù…ØªØ¨Ù‚ÙŠ'],
                    datasets: [{
                        data: [0, 1],
                        backgroundColor: ['#00b894', '#eee'],
                        borderWidth: 0
                    }]
                },
                options: { cutout: '75%', responsive: true, plugins: { legend: {display:false}, tooltip: {enabled:false} } }
            });
        }

        function updateChart(dateKey) {
            if(!myChart) return;
            const tasks = dailyHistory[dateKey] || [];
            const total = tasks.length;
            const done = tasks.filter(t => t.completed).length;
            
            let percent = 0;
            if(total > 0) percent = Math.round((done / total) * 100);

            document.getElementById('progressText').innerText = percent + "%";
            
            myChart.data.datasets[0].data = [done, total - done || 1];
            myChart.data.datasets[0].backgroundColor = total === 0 ? ['#eee', '#eee'] : ['#00b894', '#eee'];
            myChart.update();
        }

        // --- Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª ÙˆØ§Ø­ØªÙØ§Ù„ ---
        const quotes = [
            "Ø£Ø¹Ø¸Ù… Ø«Ø±ÙˆØ© Ù‡ÙŠ Ø«Ø±ÙˆØ© Ø§Ù„ÙˆÙ‚Øª.", "Ø§Ù„Ù†Ø¬Ø§Ø­ Ù‡Ùˆ Ù…Ø¬Ù…ÙˆØ¹ Ù…Ø¬Ù‡ÙˆØ¯Ø§Øª ØµØºÙŠØ±Ø©.", "Ù„Ø§ ØªØ¤Ø¬Ù„ Ø¹Ù…Ù„ Ø§Ù„ÙŠÙˆÙ… Ø¥Ù„Ù‰ Ø§Ù„ØºØ¯."
        ];
        function showCelebration() {
            document.getElementById('celebrationModal').classList.add('show');
            document.getElementById('quoteText').innerText = quotes[Math.floor(Math.random() * quotes.length)];
        }
        function closeModal() {
            document.getElementById('celebrationModal').classList.remove('show');
        }

    </script>
</body>
</html>
